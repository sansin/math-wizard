// Math Modules and Topics by Grade
// Used for AI-powered question generation with proper complexity assessment

export const mathModulesByGrade = {
  'KG-1': {
    gradeLevel: 'KG - 1st Grade',
    complexity: 'beginner',
    modules: [
      {
        name: 'Addition',
        topics: [
          'Introduction to Addition',
          'Addition on Number Line',
          'Addition Patterns',
          'Single-digit Addition',
          'Two-digit Addition',
        ],
      },
      {
        name: 'Subtraction',
        topics: [
          'Introduction to Subtraction',
          'Subtraction on Number Line',
          'Single-digit Subtraction',
          'Two-digit Subtraction',
          'Number Patterns in Subtraction',
        ],
      },
      {
        name: 'Multiplication',
        topics: [
          'Counting in Groups',
          'Introduction to Multiplication',
          'Repeated Addition',
          'Multiplication Tables (2-10)',
          'Multiplication Properties',
        ],
      },
      {
        name: 'Division',
        topics: [
          'Introduction to Division',
          'Division as Grouping',
          'Division as Sharing',
          'Basic Division Facts',
          'Speed Division',
        ],
      },
      {
        name: 'Fractions',
        topics: [
          'Introduction to Fractions',
          'Halves and Thirds',
          'Equivalent Fractions',
          'Like and Unlike Fractions',
          'Fractions of a Whole',
        ],
      },
      {
        name: 'Logic & Patterns',
        topics: [
          'Pattern Recognition',
          'Logical Thinking',
          'Arithmetic Progressions',
          'Geometric Patterns',
          'Puzzles and Games',
        ],
      },
    ],
  },
  '2-3': {
    gradeLevel: 'Grade 2-3',
    complexity: 'elementary',
    modules: [
      {
        name: 'Arithmetic Operations',
        topics: [
          'Addition with Regrouping',
          'Subtraction with Regrouping',
          'Multiplication Facts',
          'Division Facts',
          'Multi-digit Addition & Subtraction',
        ],
      },
      {
        name: 'Fractions & Decimals',
        topics: [
          'Understanding Fractions',
          'Comparing Fractions',
          'Introduction to Decimals',
          'Decimal Place Value',
          'Fraction Operations',
        ],
      },
      {
        name: 'Geometry',
        topics: [
          'Shapes and Properties',
          'Angles Basics',
          'Perimeter and Area',
          'Symmetry',
          'Coordinate Geometry Intro',
        ],
      },
      {
        name: 'Variables & Equations',
        topics: [
          'Introduction to Variables',
          'Simple Equations',
          'Balancing Equations',
          'Word Problems with Variables',
          'Solving for Unknown',
        ],
      },
    ],
  },
  '4-5': {
    gradeLevel: 'Grade 4-5',
    complexity: 'intermediate',
    modules: [
      {
        name: 'Arithmetic',
        topics: [
          'Multi-digit Multiplication',
          'Long Division',
          'Decimal Operations',
          'Fraction Addition & Subtraction',
          'Mixed Numbers',
        ],
      },
      {
        name: 'Fractions & Decimals',
        topics: [
          'Equivalent Fractions',
          'Comparing and Ordering Fractions',
          'Decimal Place Value',
          'Decimal Comparison',
          'Fraction-Decimal Conversion',
        ],
      },
      {
        name: 'Geometry',
        topics: [
          'Angles and Triangles',
          'Quadrilaterals',
          'Perimeter and Area Calculation',
          'Volume Basics',
          'Coordinate Geometry',
        ],
      },
      {
        name: 'Algebra',
        topics: [
          'Variables and Expressions',
          'Equations with Variables',
          'Inequalities',
          'Order of Operations',
          'Function Basics',
        ],
      },
      {
        name: 'Statistics & Probability',
        topics: [
          'Data Collection and Analysis',
          'Graphs and Charts',
          'Probability Basics',
          'Mean and Median',
          'Logical Reasoning',
        ],
      },
    ],
  },
  '6-7': {
    gradeLevel: 'Grade 6-7',
    complexity: 'intermediate-advanced',
    modules: [
      {
        name: 'Arithmetic & Number Theory',
        topics: [
          'Factors and Multiples',
          'Prime Factorization',
          'GCD and LCM',
          'Whole Numbers and Integers',
          'Rational Numbers',
        ],
      },
      {
        name: 'Fractions, Decimals & Percentages',
        topics: [
          'Fraction Operations',
          'Decimal Operations',
          'Percentage Calculations',
          'Ratios and Proportions',
          'Rate Problems',
        ],
      },
      {
        name: 'Pre-Algebra',
        topics: [
          'Expressions and Equations',
          'Two-step Equations',
          'Inequalities',
          'Functions and Relations',
          'Graphing Linear Equations',
        ],
      },
      {
        name: 'Geometry',
        topics: [
          'Angles and Angle Relationships',
          'Triangles and Polygons',
          'Area and Perimeter',
          'Surface Area and Volume',
          'Coordinate Geometry',
        ],
      },
      {
        name: 'Statistics & Probability',
        topics: [
          'Data Analysis',
          'Mean, Median, Mode',
          'Probability Theory',
          'Counting Principles',
          'Sample Space',
        ],
      },
      {
        name: 'Advanced Reasoning',
        topics: [
          'Logical Deduction',
          'Pattern Analysis',
          'Puzzles and Games',
          'Mathematical Proof Basics',
          'Problem-Solving Techniques',
        ],
      },
    ],
  },
  '7-8': {
    gradeLevel: 'Grade 7-8',
    complexity: 'advanced',
    modules: [
      {
        name: 'Algebra',
        topics: [
          'Linear Equations',
          'Systems of Equations',
          'Quadratic Equations Intro',
          'Polynomials',
          'Factoring',
        ],
      },
      {
        name: 'Functions & Graphing',
        topics: [
          'Functions and Notation',
          'Linear Functions',
          'Slope and Intercepts',
          'Function Evaluation',
          'Rate of Change',
        ],
      },
      {
        name: 'Geometry & Trigonometry',
        topics: [
          'Congruence and Similarity',
          'Pythagorean Theorem',
          'Area and Volume',
          'Surface Area',
          'Coordinate Geometry',
        ],
      },
      {
        name: 'Statistics & Probability',
        topics: [
          'Probability Distributions',
          'Expected Value',
          'Mean, Median, Mode',
          'Data Analysis',
          'Counting Principles',
        ],
      },
      {
        name: 'Exponents & Roots',
        topics: [
          'Powers and Exponents',
          'Scientific Notation',
          'Radicals and Roots',
          'Rational Exponents',
          'Exponential Growth',
        ],
      },
    ],
  },
  '9+': {
    gradeLevel: 'Grade 9+',
    complexity: 'expert',
    modules: [
      {
        name: 'Algebra',
        topics: [
          'Quadratic Equations',
          'Polynomials and Factoring',
          'Rational Expressions',
          'Exponential and Logarithmic Functions',
          'Complex Numbers',
        ],
      },
      {
        name: 'Functions & Analysis',
        topics: [
          'Advanced Functions',
          'Composition of Functions',
          'Inverse Functions',
          'Limits Introduction',
          'Continuity',
        ],
      },
      {
        name: 'Geometry & Trigonometry',
        topics: [
          'Coordinate Geometry',
          'Advanced Trigonometry',
          'Trigonometric Functions',
          'Law of Sines and Cosines',
          'Vectors Basics',
        ],
      },
      {
        name: 'Calculus Basics',
        topics: [
          'Limits and Derivatives',
          'Derivative Rules',
          'Applications of Derivatives',
          'Integration Basics',
          'Fundamental Theorem',
        ],
      },
      {
        name: 'Statistics & Probability',
        topics: [
          'Advanced Probability',
          'Distributions',
          'Hypothesis Testing',
          'Regression Analysis',
          'Bayesian Statistics',
        ],
      },
      {
        name: 'Mathematical Reasoning',
        topics: [
          'Mathematical Proofs',
          'Logical Argumentation',
          'Discrete Mathematics',
          'Set Theory',
          'Combinatorics',
        ],
      },
    ],
  },
};

/**
 * Get all modules and topics for a specific grade
 * @param {string} grade - Grade level (e.g., 'KG-1', '2-3', '4-5', '6-7', '7-8', '9+')
 * @returns {object} Modules and topics for the grade
 */
export const getModulesByGrade = (grade) => {
  return mathModulesByGrade[grade] || mathModulesByGrade['4-5']; // Default to 4-5 if grade not found
};

/**
 * Get all topics for a specific grade
 * @param {string} grade - Grade level
 * @returns {array} Array of all topics for the grade
 */
export const getTopicsByGrade = (grade) => {
  const modules = getModulesByGrade(grade);
  const topics = [];
  modules.modules.forEach((module) => {
    topics.push(...module.topics);
  });
  return topics;
};

/**
 * Get a random topic for a specific grade
 * @param {string} grade - Grade level
 * @returns {string} Random topic from the grade's modules
 */
export const getRandomTopicByGrade = (grade) => {
  const topics = getTopicsByGrade(grade);
  return topics[Math.floor(Math.random() * topics.length)];
};

/**
 * Get complexity level for a grade
 * @param {string} grade - Grade level
 * @returns {string} Complexity level (beginner, elementary, intermediate, intermediate-advanced, advanced, expert)
 */
export const getComplexityByGrade = (grade) => {
  return getModulesByGrade(grade).complexity;
};

/**
 * Map grade to numeric level for complexity assessment
 * @param {string} grade - Grade level
 * @returns {number} Numeric complexity level (1-6)
 */
export const getGradeComplexityScore = (grade) => {
  const complexityMap = {
    'KG-1': 1,
    '2-3': 2,
    '4-5': 3,
    '6-7': 4,
    '7-8': 5,
    '9+': 6,
  };
  return complexityMap[grade] || 3;
};

/**
 * Get difficulty thresholds for a specific grade
 * Different grades have different performance thresholds for difficulty levels
 * Younger grades need easier questions, older grades can handle harder ones
 * @param {string} grade - Grade level
 * @returns {object} Thresholds: { veryEasy, easy, medium, hard, veryHard }
 */
export const getDifficultyThresholdsForGrade = (grade) => {
  const thresholds = {
    'KG-1': {
      veryEasy: 0,      // < 25% accuracy
      easy: 0.25,       // 25-40% accuracy
      medium: 0.40,     // 40-60% accuracy
      hard: 0.60,       // 60-75% accuracy
      veryHard: 0.75,   // > 75% accuracy
    },
    '2-3': {
      veryEasy: 0.10,   // < 10% accuracy
      easy: 0.30,       // 10-30% accuracy
      medium: 0.50,     // 30-50% accuracy
      hard: 0.70,       // 50-70% accuracy
      veryHard: 0.85,   // > 70% accuracy
    },
    '4-5': {
      veryEasy: 0.20,   // < 20% accuracy
      easy: 0.40,       // 20-40% accuracy
      medium: 0.60,     // 40-60% accuracy
      hard: 0.75,       // 60-75% accuracy
      veryHard: 0.85,   // > 75% accuracy
    },
    '6-7': {
      veryEasy: 0.30,   // < 30% accuracy
      easy: 0.50,       // 30-50% accuracy
      medium: 0.65,     // 50-65% accuracy
      hard: 0.80,       // 65-80% accuracy
      veryHard: 0.88,   // > 80% accuracy
    },
    '7-8': {
      veryEasy: 0.40,   // < 40% accuracy
      easy: 0.55,       // 40-55% accuracy
      medium: 0.70,     // 55-70% accuracy
      hard: 0.82,       // 70-82% accuracy
      veryHard: 0.90,   // > 82% accuracy
    },
    '9+': {
      veryEasy: 0.50,   // < 50% accuracy
      easy: 0.65,       // 50-65% accuracy
      medium: 0.75,     // 65-75% accuracy
      hard: 0.85,       // 75-85% accuracy
      veryHard: 0.92,   // > 85% accuracy
    },
  };
  
  return thresholds[grade] || thresholds['4-5'];
};

/**
 * Calculate difficulty level based on accuracy and grade
 * @param {number} correct - Number of correct answers
 * @param {number} total - Total number of questions
 * @param {string} grade - Student's grade level
 * @returns {object} { difficulty, accuracy, threshold }
 */
export const calculateGradeAwareDifficulty = (correct, total, grade = '4-5') => {
  const accuracy = total > 0 ? correct / total : 0;
  const thresholds = getDifficultyThresholdsForGrade(grade);
  
  let difficulty;
  let threshold;
  
  if (accuracy < thresholds.veryEasy) {
    difficulty = 'Very Easy';
    threshold = thresholds.veryEasy;
  } else if (accuracy < thresholds.easy) {
    difficulty = 'Easy';
    threshold = thresholds.easy;
  } else if (accuracy < thresholds.medium) {
    difficulty = 'Medium';
    threshold = thresholds.medium;
  } else if (accuracy < thresholds.hard) {
    difficulty = 'Hard';
    threshold = thresholds.hard;
  } else {
    difficulty = 'Very Hard';
    threshold = thresholds.veryHard;
  }
  
  return {
    difficulty,
    accuracy: Math.round(accuracy * 100),
    threshold: Math.round(threshold * 100),
  };
};
