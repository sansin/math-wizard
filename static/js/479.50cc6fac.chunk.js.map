{"version":3,"file":"static/js/479.50cc6fac.chunk.js","mappings":"wJAGO,MAAMA,EAAqB,CAChC,OAAQ,CACNC,WAAY,iBACZC,WAAY,WACZC,QAAS,CACP,CACEC,KAAM,WACNC,OAAQ,CACN,2BACA,0BACA,oBACA,wBACA,uBAGJ,CACED,KAAM,cACNC,OAAQ,CACN,8BACA,6BACA,2BACA,wBACA,mCAGJ,CACED,KAAM,iBACNC,OAAQ,CACN,qBACA,iCACA,oBACA,+BACA,8BAGJ,CACED,KAAM,WACNC,OAAQ,CACN,2BACA,uBACA,sBACA,uBACA,mBAGJ,CACED,KAAM,YACNC,OAAQ,CACN,4BACA,oBACA,uBACA,4BACA,yBAGJ,CACED,KAAM,mBACNC,OAAQ,CACN,sBACA,mBACA,0BACA,qBACA,wBAKR,MAAO,CACLJ,WAAY,YACZC,WAAY,aACZC,QAAS,CACP,CACEC,KAAM,wBACNC,OAAQ,CACN,2BACA,8BACA,uBACA,iBACA,uCAGJ,CACED,KAAM,uBACNC,OAAQ,CACN,0BACA,sBACA,2BACA,sBACA,wBAGJ,CACED,KAAM,WACNC,OAAQ,CACN,wBACA,gBACA,qBACA,WACA,8BAGJ,CACED,KAAM,wBACNC,OAAQ,CACN,4BACA,mBACA,sBACA,+BACA,0BAKR,MAAO,CACLJ,WAAY,YACZC,WAAY,eACZC,QAAS,CACP,CACEC,KAAM,aACNC,OAAQ,CACN,6BACA,gBACA,qBACA,kCACA,kBAGJ,CACED,KAAM,uBACNC,OAAQ,CACN,uBACA,mCACA,sBACA,qBACA,gCAGJ,CACED,KAAM,WACNC,OAAQ,CACN,uBACA,iBACA,iCACA,gBACA,wBAGJ,CACED,KAAM,UACNC,OAAQ,CACN,4BACA,2BACA,eACA,sBACA,oBAGJ,CACED,KAAM,2BACNC,OAAQ,CACN,+BACA,oBACA,qBACA,kBACA,wBAKR,MAAO,CACLJ,WAAY,YACZC,WAAY,wBACZC,QAAS,CACP,CACEC,KAAM,6BACNC,OAAQ,CACN,wBACA,sBACA,cACA,6BACA,qBAGJ,CACED,KAAM,oCACNC,OAAQ,CACN,sBACA,qBACA,0BACA,yBACA,kBAGJ,CACED,KAAM,cACNC,OAAQ,CACN,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","sources":["data/mathModules.js","services/aiService.js","components/QuestionCard.jsx","services/challengeService.js","components/ChallengeMode.jsx","components/ModuleSelector.jsx"],"sourcesContent":["// Math Modules and Topics by Grade\n// Used for AI-powered question generation with proper complexity assessment\n\nexport const mathModulesByGrade = {\n  'KG-1': {\n    gradeLevel: 'KG - 1st Grade',\n    complexity: 'beginner',\n    modules: [\n      {\n        name: 'Addition',\n        topics: [\n          'Introduction to Addition',\n          'Addition on Number Line',\n          'Addition Patterns',\n          'Single-digit Addition',\n          'Two-digit Addition',\n        ],\n      },\n      {\n        name: 'Subtraction',\n        topics: [\n          'Introduction to Subtraction',\n          'Subtraction on Number Line',\n          'Single-digit Subtraction',\n          'Two-digit Subtraction',\n          'Number Patterns in Subtraction',\n        ],\n      },\n      {\n        name: 'Multiplication',\n        topics: [\n          'Counting in Groups',\n          'Introduction to Multiplication',\n          'Repeated Addition',\n          'Multiplication Tables (2-10)',\n          'Multiplication Properties',\n        ],\n      },\n      {\n        name: 'Division',\n        topics: [\n          'Introduction to Division',\n          'Division as Grouping',\n          'Division as Sharing',\n          'Basic Division Facts',\n          'Speed Division',\n        ],\n      },\n      {\n        name: 'Fractions',\n        topics: [\n          'Introduction to Fractions',\n          'Halves and Thirds',\n          'Equivalent Fractions',\n          'Like and Unlike Fractions',\n          'Fractions of a Whole',\n        ],\n      },\n      {\n        name: 'Logic & Patterns',\n        topics: [\n          'Pattern Recognition',\n          'Logical Thinking',\n          'Arithmetic Progressions',\n          'Geometric Patterns',\n          'Puzzles and Games',\n        ],\n      },\n    ],\n  },\n  '2-3': {\n    gradeLevel: 'Grade 2-3',\n    complexity: 'elementary',\n    modules: [\n      {\n        name: 'Arithmetic Operations',\n        topics: [\n          'Addition with Regrouping',\n          'Subtraction with Regrouping',\n          'Multiplication Facts',\n          'Division Facts',\n          'Multi-digit Addition & Subtraction',\n        ],\n      },\n      {\n        name: 'Fractions & Decimals',\n        topics: [\n          'Understanding Fractions',\n          'Comparing Fractions',\n          'Introduction to Decimals',\n          'Decimal Place Value',\n          'Fraction Operations',\n        ],\n      },\n      {\n        name: 'Geometry',\n        topics: [\n          'Shapes and Properties',\n          'Angles Basics',\n          'Perimeter and Area',\n          'Symmetry',\n          'Coordinate Geometry Intro',\n        ],\n      },\n      {\n        name: 'Variables & Equations',\n        topics: [\n          'Introduction to Variables',\n          'Simple Equations',\n          'Balancing Equations',\n          'Word Problems with Variables',\n          'Solving for Unknown',\n        ],\n      },\n    ],\n  },\n  '4-5': {\n    gradeLevel: 'Grade 4-5',\n    complexity: 'intermediate',\n    modules: [\n      {\n        name: 'Arithmetic',\n        topics: [\n          'Multi-digit Multiplication',\n          'Long Division',\n          'Decimal Operations',\n          'Fraction Addition & Subtraction',\n          'Mixed Numbers',\n        ],\n      },\n      {\n        name: 'Fractions & Decimals',\n        topics: [\n          'Equivalent Fractions',\n          'Comparing and Ordering Fractions',\n          'Decimal Place Value',\n          'Decimal Comparison',\n          'Fraction-Decimal Conversion',\n        ],\n      },\n      {\n        name: 'Geometry',\n        topics: [\n          'Angles and Triangles',\n          'Quadrilaterals',\n          'Perimeter and Area Calculation',\n          'Volume Basics',\n          'Coordinate Geometry',\n        ],\n      },\n      {\n        name: 'Algebra',\n        topics: [\n          'Variables and Expressions',\n          'Equations with Variables',\n          'Inequalities',\n          'Order of Operations',\n          'Function Basics',\n        ],\n      },\n      {\n        name: 'Statistics & Probability',\n        topics: [\n          'Data Collection and Analysis',\n          'Graphs and Charts',\n          'Probability Basics',\n          'Mean and Median',\n          'Logical Reasoning',\n        ],\n      },\n    ],\n  },\n  '6-7': {\n    gradeLevel: 'Grade 6-7',\n    complexity: 'intermediate-advanced',\n    modules: [\n      {\n        name: 'Arithmetic & Number Theory',\n        topics: [\n          'Factors and Multiples',\n          'Prime Factorization',\n          'GCD and LCM',\n          'Whole Numbers and Integers',\n          'Rational Numbers',\n        ],\n      },\n      {\n        name: 'Fractions, Decimals & Percentages',\n        topics: [\n          'Fraction Operations',\n          'Decimal Operations',\n          'Percentage Calculations',\n          'Ratios and Proportions',\n          'Rate Problems',\n        ],\n      },\n      {\n        name: 'Pre-Algebra',\n        topics: [\n          'Expressions and Equations',\n          'Two-step Equations',\n          'Inequalities',\n          'Functions and Relations',\n          'Graphing Linear Equations',\n        ],\n      },\n      {\n        name: 'Geometry',\n        topics: [\n          'Angles and Angle Relationships',\n          'Triangles and Polygons',\n          'Area and Perimeter',\n          'Surface Area and Volume',\n          'Coordinate Geometry',\n        ],\n      },\n      {\n        name: 'Statistics & Probability',\n        topics: [\n          'Data Analysis',\n          'Mean, Median, Mode',\n          'Probability Theory',\n          'Counting Principles',\n          'Sample Space',\n        ],\n      },\n      {\n        name: 'Advanced Reasoning',\n        topics: [\n          'Logical Deduction',\n          'Pattern Analysis',\n          'Puzzles and Games',\n          'Mathematical Proof Basics',\n          'Problem-Solving Techniques',\n        ],\n      },\n    ],\n  },\n  '7-8': {\n    gradeLevel: 'Grade 7-8',\n    complexity: 'advanced',\n    modules: [\n      {\n        name: 'Algebra',\n        topics: [\n          'Linear Equations',\n          'Systems of Equations',\n          'Quadratic Equations Intro',\n          'Polynomials',\n          'Factoring',\n        ],\n      },\n      {\n        name: 'Functions & Graphing',\n        topics: [\n          'Functions and Notation',\n          'Linear Functions',\n          'Slope and Intercepts',\n          'Function Evaluation',\n          'Rate of Change',\n        ],\n      },\n      {\n        name: 'Geometry & Trigonometry',\n        topics: [\n          'Congruence and Similarity',\n          'Pythagorean Theorem',\n          'Area and Volume',\n          'Surface Area',\n          'Coordinate Geometry',\n        ],\n      },\n      {\n        name: 'Statistics & Probability',\n        topics: [\n          'Probability Distributions',\n          'Expected Value',\n          'Mean, Median, Mode',\n          'Data Analysis',\n          'Counting Principles',\n        ],\n      },\n      {\n        name: 'Exponents & Roots',\n        topics: [\n          'Powers and Exponents',\n          'Scientific Notation',\n          'Radicals and Roots',\n          'Rational Exponents',\n          'Exponential Growth',\n        ],\n      },\n    ],\n  },\n  '9+': {\n    gradeLevel: 'Grade 9+',\n    complexity: 'expert',\n    modules: [\n      {\n        name: 'Algebra',\n        topics: [\n          'Quadratic Equations',\n          'Polynomials and Factoring',\n          'Rational Expressions',\n          'Exponential and Logarithmic Functions',\n          'Complex Numbers',\n        ],\n      },\n      {\n        name: 'Functions & Analysis',\n        topics: [\n          'Advanced Functions',\n          'Composition of Functions',\n          'Inverse Functions',\n          'Limits Introduction',\n          'Continuity',\n        ],\n      },\n      {\n        name: 'Geometry & Trigonometry',\n        topics: [\n          'Coordinate Geometry',\n          'Advanced Trigonometry',\n          'Trigonometric Functions',\n          'Law of Sines and Cosines',\n          'Vectors Basics',\n        ],\n      },\n      {\n        name: 'Calculus Basics',\n        topics: [\n          'Limits and Derivatives',\n          'Derivative Rules',\n          'Applications of Derivatives',\n          'Integration Basics',\n          'Fundamental Theorem',\n        ],\n      },\n      {\n        name: 'Statistics & Probability',\n        topics: [\n          'Advanced Probability',\n          'Distributions',\n          'Hypothesis Testing',\n          'Regression Analysis',\n          'Bayesian Statistics',\n        ],\n      },\n      {\n        name: 'Mathematical Reasoning',\n        topics: [\n          'Mathematical Proofs',\n          'Logical Argumentation',\n          'Discrete Mathematics',\n          'Set Theory',\n          'Combinatorics',\n        ],\n      },\n    ],\n  },\n};\n\n/**\n * Get all modules and topics for a specific grade\n * @param {string} grade - Grade level (e.g., 'KG-1', '2-3', '4-5', '6-7', '7-8', '9+')\n * @returns {object} Modules and topics for the grade\n */\nexport const getModulesByGrade = (grade) => {\n  return mathModulesByGrade[grade] || mathModulesByGrade['4-5']; // Default to 4-5 if grade not found\n};\n\n/**\n * Get all topics for a specific grade\n * @param {string} grade - Grade level\n * @returns {array} Array of all topics for the grade\n */\nexport const getTopicsByGrade = (grade) => {\n  const modules = getModulesByGrade(grade);\n  const topics = [];\n  modules.modules.forEach((module) => {\n    topics.push(...module.topics);\n  });\n  return topics;\n};\n\n/**\n * Get a random topic for a specific grade\n * @param {string} grade - Grade level\n * @returns {string} Random topic from the grade's modules\n */\nexport const getRandomTopicByGrade = (grade) => {\n  const topics = getTopicsByGrade(grade);\n  return topics[Math.floor(Math.random() * topics.length)];\n};\n\n/**\n * Get complexity level for a grade\n * @param {string} grade - Grade level\n * @returns {string} Complexity level (beginner, elementary, intermediate, intermediate-advanced, advanced, expert)\n */\nexport const getComplexityByGrade = (grade) => {\n  return getModulesByGrade(grade).complexity;\n};\n\n/**\n * Map grade to numeric level for complexity assessment\n * @param {string} grade - Grade level\n * @returns {number} Numeric complexity level (1-6)\n */\nexport const getGradeComplexityScore = (grade) => {\n  const complexityMap = {\n    'KG-1': 1,\n    '2-3': 2,\n    '4-5': 3,\n    '6-7': 4,\n    '7-8': 5,\n    '9+': 6,\n  };\n  return complexityMap[grade] || 3;\n};\n\n/**\n * Get difficulty thresholds for a specific grade\n * Different grades have different performance thresholds for difficulty levels\n * Younger grades need easier questions, older grades can handle harder ones\n * @param {string} grade - Grade level\n * @returns {object} Thresholds: { veryEasy, easy, medium, hard, veryHard }\n */\nexport const getDifficultyThresholdsForGrade = (grade) => {\n  const thresholds = {\n    'KG-1': {\n      veryEasy: 0,      // < 25% accuracy\n      easy: 0.25,       // 25-40% accuracy\n      medium: 0.40,     // 40-60% accuracy\n      hard: 0.60,       // 60-75% accuracy\n      veryHard: 0.75,   // > 75% accuracy\n    },\n    '2-3': {\n      veryEasy: 0.10,   // < 10% accuracy\n      easy: 0.30,       // 10-30% accuracy\n      medium: 0.50,     // 30-50% accuracy\n      hard: 0.70,       // 50-70% accuracy\n      veryHard: 0.85,   // > 70% accuracy\n    },\n    '4-5': {\n      veryEasy: 0.20,   // < 20% accuracy\n      easy: 0.40,       // 20-40% accuracy\n      medium: 0.60,     // 40-60% accuracy\n      hard: 0.75,       // 60-75% accuracy\n      veryHard: 0.85,   // > 75% accuracy\n    },\n    '6-7': {\n      veryEasy: 0.30,   // < 30% accuracy\n      easy: 0.50,       // 30-50% accuracy\n      medium: 0.65,     // 50-65% accuracy\n      hard: 0.80,       // 65-80% accuracy\n      veryHard: 0.88,   // > 80% accuracy\n    },\n    '7-8': {\n      veryEasy: 0.40,   // < 40% accuracy\n      easy: 0.55,       // 40-55% accuracy\n      medium: 0.70,     // 55-70% accuracy\n      hard: 0.82,       // 70-82% accuracy\n      veryHard: 0.90,   // > 82% accuracy\n    },\n    '9+': {\n      veryEasy: 0.50,   // < 50% accuracy\n      easy: 0.65,       // 50-65% accuracy\n      medium: 0.75,     // 65-75% accuracy\n      hard: 0.85,       // 75-85% accuracy\n      veryHard: 0.92,   // > 85% accuracy\n    },\n  };\n  \n  return thresholds[grade] || thresholds['4-5'];\n};\n\n/**\n * Calculate difficulty level based on accuracy and grade\n * @param {number} correct - Number of correct answers\n * @param {number} total - Total number of questions\n * @param {string} grade - Student's grade level\n * @returns {object} { difficulty, accuracy, threshold }\n */\nexport const calculateGradeAwareDifficulty = (correct, total, grade = '4-5') => {\n  const accuracy = total > 0 ? correct / total : 0;\n  const thresholds = getDifficultyThresholdsForGrade(grade);\n  \n  let difficulty;\n  let threshold;\n  \n  if (accuracy < thresholds.veryEasy) {\n    difficulty = 'Very Easy';\n    threshold = thresholds.veryEasy;\n  } else if (accuracy < thresholds.easy) {\n    difficulty = 'Easy';\n    threshold = thresholds.easy;\n  } else if (accuracy < thresholds.medium) {\n    difficulty = 'Medium';\n    threshold = thresholds.medium;\n  } else if (accuracy < thresholds.hard) {\n    difficulty = 'Hard';\n    threshold = thresholds.hard;\n  } else {\n    difficulty = 'Very Hard';\n    threshold = thresholds.veryHard;\n  }\n  \n  return {\n    difficulty,\n    accuracy: Math.round(accuracy * 100),\n    threshold: Math.round(threshold * 100),\n  };\n};\n","import axios from 'axios';\nimport { getRandomTopicByGrade, mathModulesByGrade } from '../data/mathModules';\n\n/**\n * Generate a question. Always returns { question: string, answer: number|string|null }\n * - AI path: returns both question and answer from GPT\n * - Fallback path: returns question only (answer = null, caller must compute)\n */\nconst generateQuestion = async (userHistory, userGrade, operation, selectedModules = []) => {\n  // List of operations that benefit from AI generation (more variety, better contextuality)\n  const aiPreferredOperations = ['logic_patterns', 'algebra', 'geometry', 'statistics', 'calculus', 'fractions', 'decimals'];\n  const isAiPreferred = aiPreferredOperations.includes(operation);\n  \n  // If specific modules are selected, always use AI to ensure module-specific questions\n  if (selectedModules && selectedModules.length > 0 && process.env.REACT_APP_OPENAI_API_KEY) {\n    return generateAIQuestion(userHistory, userGrade, operation, selectedModules, isAiPreferred);\n  }\n  \n  // For AI-preferred operations, use AI 90% of the time (increased from 70%)\n  // For other operations, use AI 70% of the time\n  const aiProbability = isAiPreferred ? 0.9 : 0.7;\n  if (process.env.REACT_APP_OPENAI_API_KEY && Math.random() < aiProbability) {\n    return generateAIQuestion(userHistory, userGrade, operation, selectedModules, isAiPreferred);\n  }\n  \n  // Fallback to rule-based generation (answer computed by caller)\n  const fallbackQ = generateFallbackQuestion(operation, userGrade);\n  return { question: fallbackQ, answer: null };\n};\n\n/**\n * Get a random topic from selected modules\n * Falls back to random topic by grade if no modules selected\n */\nconst getTopicFromSelectedModules = (userGrade, selectedModules) => {\n  if (!selectedModules || selectedModules.length === 0) {\n    return getRandomTopicByGrade(userGrade);\n  }\n  \n  const gradeData = mathModulesByGrade[userGrade];\n  \n  if (!gradeData || !gradeData.modules) {\n    return getRandomTopicByGrade(userGrade);\n  }\n  \n  // Collect all topics from selected modules\n  const topicsFromSelectedModules = [];\n  gradeData.modules.forEach(module => {\n    if (selectedModules.includes(module.name)) {\n      topicsFromSelectedModules.push(...module.topics);\n    }\n  });\n  \n  // Return random topic from selected modules, or fallback\n  if (topicsFromSelectedModules.length > 0) {\n    return topicsFromSelectedModules[Math.floor(Math.random() * topicsFromSelectedModules.length)];\n  }\n  \n  return getRandomTopicByGrade(userGrade);\n};\n\n/**\n * Generate AI question using OpenAI API\n * Incorporates grade-specific topics and complexity assessment\n * Uses topics from selected modules if available\n */\nconst generateAIQuestion = async (userHistory, userGrade, operation, selectedModules = [], isAiPreferred = false) => {\n  try {\n    const relevantTopic = getTopicFromSelectedModules(userGrade, selectedModules);\n    \n    // Determine complexity based on user performance\n    let complexityLevel = 'medium';\n    if (userHistory && userHistory.length > 0) {\n      const recentAccuracy = userHistory.slice(-10).reduce((sum, h) => sum + (h.correct ? 1 : 0), 0) / Math.min(10, userHistory.length);\n      if (recentAccuracy > 0.85) complexityLevel = 'hard';\n      else if (recentAccuracy > 0.70) complexityLevel = 'medium';\n      else complexityLevel = 'easy';\n    }\n\n    // Build module context string\n    const moduleContext = selectedModules && selectedModules.length > 0 \n      ? `Selected modules: ${selectedModules.join(', ')}\\n`\n      : '';\n\n    // Determine the question type based on operation and modules\n    let questionTypeGuidance = '';\n    const hasLogicPatterns = selectedModules && selectedModules.some(m => m.includes('Logic & Patterns'));\n    \n    if (hasLogicPatterns || operation === 'logic_patterns' || operation === 'logic_patterns_problem') {\n      questionTypeGuidance = `QUESTION TYPE: Logic & Patterns - Generate UNIQUE pattern/sequence questions.\nVARIETY: Use different types each time:\n- Number sequences (arithmetic, geometric, Fibonacci-like)\n- Letter sequences (alphabetical, skipping patterns)\n- Mixed alphanumeric patterns (1A, 2B, etc.)\n- Visual/shape patterns descriptions\n- Logical reasoning puzzles\n- Alternating patterns\nExamples: \"What comes next: 2, 4, 6, 8, ___?\", \"Find the pattern: 1, 1, 2, 3, 5, 8, ___?\", \"Identify: A, C, E, G, ___?\"\nCRITICAL: Each question must be DIFFERENT from previous ones. Focus on pattern recognition, NOT simple arithmetic.`;\n    } else if (operation === 'algebra' || operation === 'algebra_problem') {\n      questionTypeGuidance = `QUESTION TYPE: Algebra - Generate UNIQUE algebraic equations and expressions.\nVARIETY: Use different structures each time:\n- Linear equations (2x + 5 = 13, 3x - 7 = 8)\n- Variable relationships (If y = 2x and x = 5, what is y?)\n- Expression simplification (4x + 2x, 5a - 2a + 3a)\n- Multi-step equations\n- Word problems with variables\nExamples: \"If 2x + 5 = 13, what is x?\", \"Simplify: 3x + 2x\", \"If y = 2x and x = 5, what is y?\"\nCRITICAL: Do NOT generate simple arithmetic. Must involve variables or algebraic thinking.`;\n    } else if (operation === 'geometry' || operation === 'geometry_problem') {\n      questionTypeGuidance = `QUESTION TYPE: Geometry - Generate UNIQUE geometric problems.\nVARIETY: Use different concepts each time:\n- Area calculations (rectangles, triangles, circles, squares)\n- Perimeter and circumference\n- Volume calculations\n- Angle relationships\n- Coordinate geometry\n- 3D shapes\nExamples: \"What is the area of a rectangle 8cm  5cm?\", \"If a square has area 36, what is its perimeter?\", \"A triangle has base 10cm and height 6cm. What is its area?\"\nCRITICAL: Do NOT generate simple arithmetic. Must involve geometric concepts.`;\n    } else if (operation === 'statistics' || operation === 'statistics_problem') {\n      questionTypeGuidance = `QUESTION TYPE: Statistics & Probability - Generate UNIQUE statistical problems.\nVARIETY: Use different concepts each time:\n- Mean, median, mode, range\n- Probability (dice, coins, cards, combinations)\n- Data interpretation\n- Distribution analysis\n- Conditional probability\nExamples: \"If a die is rolled, what is the probability of getting a 3?\", \"What is the mean of 2, 4, 6, 8?\", \"What is the median of 3, 5, 7, 9, 11?\"\nCRITICAL: Do NOT generate simple arithmetic. Must involve statistical thinking.`;\n    } else if (operation === 'calculus' || operation === 'calculus_problem') {\n      questionTypeGuidance = `QUESTION TYPE: Calculus - Generate UNIQUE calculus concepts.\nVARIETY: Use different techniques each time:\n- Derivatives (power rule, chain rule)\n- Limits\n- Integration\n- Rates of change\n- Critical points\nExamples: \"What is the derivative of x?\", \"Find the limit as x approaches 2 of (x + 1)\", \"What is the derivative of 3x + 2x?\"\nCRITICAL: Do NOT generate simple arithmetic. Must involve calculus concepts.`;\n    } else if (operation === 'fractions' || operation === 'fractions_problem') {\n      questionTypeGuidance = `QUESTION TYPE: Fractions - Generate UNIQUE fraction problems.\nVARIETY: Use different operations each time:\n- Addition of fractions (1/4 + 1/4, 1/2 + 1/3)\n- Subtraction of fractions\n- Multiplication/Division of fractions\n- Simplification (4/8, 6/12)\n- Finding fractions of numbers (1/3 of 30)\n- Word problems with fractions\nExamples: \"What is 1/4 + 1/4?\", \"What is 2/3 of 18?\", \"Simplify: 4/8\"\nCRITICAL: Focus on fractions, not basic arithmetic with whole numbers.`;\n    } else if (operation === 'decimals' || operation === 'decimals_problem') {\n      questionTypeGuidance = `QUESTION TYPE: Decimals - Generate UNIQUE decimal problems.\nVARIETY: Use different operations each time:\n- Addition of decimals (2.5 + 1.3)\n- Subtraction of decimals\n- Multiplication of decimals\n- Division of decimals\n- Decimal to fraction conversion\n- Real-world decimal problems (money, measurements)\nExamples: \"What is 2.5 + 1.3?\", \"Multiply: 2.5  4\", \"What is 10.5  2?\"\nCRITICAL: Focus on decimals, not basic arithmetic with whole numbers.`;\n    }\n\n    // Add guidance for exponents when the module is selected\n    const hasExponents = selectedModules && selectedModules.some(m => m.includes('Exponents'));\n    if (hasExponents && !questionTypeGuidance) {\n      questionTypeGuidance = `QUESTION TYPE: Exponents & Roots - Generate UNIQUE exponent and root problems.\nVARIETY: Use different concepts each time:\n- Powers (What is 2?, What is 3?)\n- Square roots (What is 144?, 81?)\n- Cube roots (What is 27?)\n- Scientific notation (Express 5000 in scientific notation)\n- Exponent rules (Simplify 2  2)\n- Negative exponents (What is 2?)\nExamples: \"What is 2?\", \"What is 144?\", \"Simplify: 3  3\", \"What is 5?\"\nCRITICAL: The answer must ALWAYS be a single number. Do NOT generate questions about growth rates or word problems.`;\n    }\n\n    const prompt = `Generate a single UNIQUE and FRESH math question for a ${userGrade} grade student STRICTLY based on the selected modules.\n\n${moduleContext}Topic: ${relevantTopic}\nComplexity: ${complexityLevel}\n\n${questionTypeGuidance}\n\nCRITICAL REQUIREMENTS:\n- MUST focus on the topic: \"${relevantTopic}\" from modules: ${selectedModules.join(', ')}\n- Generate a COMPLETELY NEW and DIFFERENT question (not a variation of common questions)\n- Keep it to one sentence maximum\n- Make it engaging and age-appropriate for grade ${userGrade}\n- NEVER generate: simple arithmetic like \"What is X + Y?\", \"What is X - Y?\", \"What is X  Y?\", \"What is X  Y?\" with just numbers\n- Must be conceptually appropriate for the selected module\n- Make the question INTERESTING and VARIED\n\nRESPONSE FORMAT: You MUST respond with a valid JSON object and nothing else.\nThe JSON must have exactly two keys:\n- \"question\": the question text (string)\n- \"answer\": the correct numeric answer (number). For letter/pattern answers use a string.\nExample: {\"question\": \"What is the area of a rectangle with length 8cm and width 5cm?\", \"answer\": 40}\nExample: {\"question\": \"What comes next: A, C, E, G, ___?\", \"answer\": \"I\"}\nDo NOT include any text outside the JSON object.`;\n\n    const response = await axios.post(\n      'https://api.openai.com/v1/chat/completions',\n      {\n        model: 'gpt-3.5-turbo',\n        messages: [{ role: 'user', content: prompt }],\n        max_tokens: 200,\n        temperature: isAiPreferred ? 0.8 : 0.5,  // Higher temperature for AI-preferred operations = more variety\n      },\n      {\n        headers: {\n          'Authorization': `Bearer ${process.env.REACT_APP_OPENAI_API_KEY}`,\n          'Content-Type': 'application/json',\n        },\n      }\n    );\n    \n    const raw = response.data.choices[0].message.content.trim();\n    \n    // Parse JSON response from AI\n    try {\n      // Strip markdown code fences if present (```json ... ```)\n      const cleaned = raw.replace(/^```(?:json)?\\s*/i, '').replace(/\\s*```$/i, '').trim();\n      const parsed = JSON.parse(cleaned);\n      if (parsed && parsed.question) {\n        return {\n          question: parsed.question,\n          answer: parsed.answer !== undefined ? parsed.answer : null,\n        };\n      }\n    } catch (parseErr) {\n      console.warn('AI response was not valid JSON, using raw text:', raw);\n    }\n    \n    // If JSON parsing failed, return raw text with no answer (fallback will compute)\n    return { question: raw, answer: null };\n  } catch (error) {\n    console.warn('AI generation failed, using fallback:', error.message);\n    const fallbackQ = generateFallbackQuestion(operation, userGrade);\n    return { question: fallbackQ, answer: null };\n  }\n};\n\nconst generateFallbackQuestion = (operation, grade = '4-5') => {\n  // Grade-specific complexity ranges\n  const gradeComplexity = {\n    'KG-1': { maxNum: 20, maxOp: 10 },\n    '2-3': { maxNum: 50, maxOp: 25 },\n    '4-5': { maxNum: 100, maxOp: 50 },\n    '6-7': { maxNum: 200, maxOp: 100 },\n    '7-8': { maxNum: 500, maxOp: 200 },\n    '9+': { maxNum: 1000, maxOp: 500 },\n  };\n\n  const complexity = gradeComplexity[grade] || gradeComplexity['4-5'];\n\n  const questionsMap = {\n    addition: [\n      `What is ${Math.floor(Math.random() * complexity.maxNum)} + ${Math.floor(Math.random() * complexity.maxOp)}?`,\n      `If you have ${Math.floor(Math.random() * complexity.maxNum)} items and get ${Math.floor(Math.random() * complexity.maxOp)} more, how many do you have?`,\n      `${Math.floor(Math.random() * complexity.maxNum)} + ${Math.floor(Math.random() * complexity.maxOp)} = ?`,\n      `Add: ${Math.floor(Math.random() * complexity.maxNum / 2)} + ${Math.floor(Math.random() * complexity.maxNum / 2)} + ${Math.floor(Math.random() * complexity.maxNum / 2)}`,\n    ],\n    subtraction: [\n      `What is ${Math.floor(Math.random() * complexity.maxNum)} - ${Math.floor(Math.random() * complexity.maxOp)}?`,\n      `If you had ${Math.floor(Math.random() * complexity.maxNum)} items and used ${Math.floor(Math.random() * complexity.maxOp)}, how many are left?`,\n      `${Math.floor(Math.random() * complexity.maxNum)} - ${Math.floor(Math.random() * complexity.maxOp)} = ?`,\n      `Subtract: ${Math.floor(Math.random() * complexity.maxNum)} - ${Math.floor(Math.random() * complexity.maxNum / 2)}`,\n    ],\n    multiplication: [\n      `What is ${Math.floor(Math.random() * 15) + 2}  ${Math.floor(Math.random() * 15) + 2}?`,\n      `If each group has ${Math.floor(Math.random() * 12) + 2} items and there are ${Math.floor(Math.random() * 12) + 2} groups, how many items total?`,\n      `${Math.floor(Math.random() * 12) + 1}  ${Math.floor(Math.random() * 12) + 1} = ?`,\n      `Multiply: ${Math.floor(Math.random() * 20) + 1}  ${Math.floor(Math.random() * 20) + 1}`,\n    ],\n    division: [\n      `What is ${Math.floor(Math.random() * complexity.maxNum)}  ${Math.floor(Math.random() * 12) + 1}?`,\n      `If you split ${Math.floor(Math.random() * complexity.maxNum)} equally among ${Math.floor(Math.random() * 12) + 1} groups, how many in each group?`,\n      `${Math.floor(Math.random() * complexity.maxNum)}  ${Math.floor(Math.random() * 12) + 1} = ?`,\n      `Divide: ${Math.floor(Math.random() * complexity.maxNum)}  ${Math.floor(Math.random() * 12) + 1}`,\n    ],\n    fractions: [\n      `What is 1/4 + 1/4?`,\n      `What is 1/3 of 30?`,\n      `If you eat 1/2 of a pizza, how much is left?`,\n      `What is 2/5 + 1/5?`,\n      `If 1/4 of a number is 25, what is the number?`,\n      `Simplify: 4/8`,\n      `What is 3/4 - 1/4?`,\n      `What is 1/2 + 1/3?`,\n      `Simplify: 6/12`,\n      `What is 2/3 of 18?`,\n      `If 1/5 of a cake is 20g, what is the whole cake?`,\n      `What is 3/5 + 1/5?`,\n      `Simplify: 5/10`,\n      `What is 1/2 of 50?`,\n    ],\n    decimals: [\n      `What is 2.5 + 1.3?`,\n      `What is 4.2 - 1.8?`,\n      `Multiply: 2.5  4`,\n      `What is 10.5  2?`,\n      `Add: 3.14 + 2.86`,\n      `What is 5.6 - 2.3?`,\n      `Multiply: 1.5  2`,\n      `What is 7.5  3?`,\n      `Add: 2.25 + 3.75`,\n      `What is 6.4 - 1.2?`,\n      `Multiply: 0.5  8`,\n      `What is 9.6  2?`,\n      `Add: 1.5 + 2.5 + 3.5`,\n      `What is 8.1 - 3.2?`,\n    ],\n    algebra: [\n      `If 2x + 5 = 13, what is x?`,\n      `Solve: 3x - 7 = 8`,\n      `If y = 2x and x = 5, what is y?`,\n      `Simplify: 4x + 2x`,\n      `If 5x = 25, what is x?`,\n      `Solve: x/2 = 10`,\n      `What is x if x + 8 = 15?`,\n      `Solve: 2x - 3 = 7`,\n      `If 3x = 21, what is x?`,\n      `Simplify: 3a + 2a + a`,\n      `Solve: 4x + 2 = 18`,\n      `If x - 5 = 10, what is x?`,\n      `What is y if y = 3x and x = 4?`,\n      `Solve: 2x + 4 = 12`,\n      `If 6x = 30, what is x?`,\n    ],\n    geometry: [\n      `What is the area of a rectangle with length 8cm and width 5cm?`,\n      `If a square has side 6cm, what is its perimeter?`,\n      `What is the area of a triangle with base 10cm and height 6cm?`,\n      `If a circle has radius 5cm, what is its circumference? (Use   3.14)`,\n      `A rectangle has area 24cm. If its width is 4cm, what is its length?`,\n      `If a square has perimeter 20cm, what is its side length?`,\n      `What is the volume of a cube with side 3cm?`,\n      `A circle has diameter 10cm. What is its radius?`,\n      `What is the area of a square with side 7cm?`,\n      `If a rectangle has length 12cm and area 60cm, what is its width?`,\n      `A triangle has base 8cm and area 20cm. What is its height?`,\n      `What is the perimeter of a rectangle 5cm  3cm?`,\n    ],\n    statistics: [\n      `If a die is rolled, what is the probability of getting a 3?`,\n      `What is the mean of 2, 4, 6, 8?`,\n      `If you flip a coin, what is the probability of getting heads?`,\n      `What is the median of 3, 5, 7, 9, 11?`,\n      `If there are 5 red balls and 3 blue balls in a bag, what is the probability of drawing a red ball?`,\n      `What is the mode of 1, 2, 2, 3, 3, 3, 4?`,\n      `If a die is rolled, what is the probability of getting an even number?`,\n      `What is the mean of 10, 20, 30?`,\n      `If you pick a card from a deck, what is the probability of getting a heart?`,\n      `What is the range of 5, 8, 12, 3, 9?`,\n      `If a die is rolled twice, what is the probability of getting two 6s?`,\n      `What is the median of 2, 4, 6, 8, 10?`,\n    ],\n    calculus: [\n      `What is the derivative of x?`,\n      `Find the limit as x approaches 2 of (x + 1)`,\n      `What is the derivative of 3x + 2x?`,\n      `Find the integral of 2x`,\n      `What is the derivative of 5x?`,\n      `Find the derivative of x + 3x`,\n      `What is the limit as x approaches 1 of (2x + 3)?`,\n      `Find the integral of x`,\n      `What is the derivative of 4x - 2x?`,\n      `Find the derivative of sin(x)`,\n    ],\n    logic_patterns: [\n      // Number sequences\n      `What comes next in the sequence: 2, 4, 6, 8, ___?`,\n      `Find the pattern: 1, 1, 2, 3, 5, 8, ___?`,\n      `What is the missing number: 5, 10, 15, ___, 25?`,\n      `Identify the pattern: 1, 4, 9, 16, ___?`,\n      `Find the pattern: 10, 20, 30, 40, ___?`,\n      `What comes next: 3, 6, 9, 12, ___?`,\n      `Continue the sequence: 2, 5, 10, 17, ___?`,\n      `What is the next number: 1, 2, 4, 8, ___?`,\n      `Find the pattern: 100, 90, 80, 70, ___?`,\n      `What comes next: 1, 3, 5, 7, ___?`,\n      `Identify the pattern: 2, 6, 12, 20, ___?`,\n      `What is the missing number: 50, 40, 30, 20, ___?`,\n      `Find the sequence: 5, 5, 10, 15, 25, ___?`,\n      `What comes next: 16, 14, 12, 10, ___?`,\n      `Continue: 1, 4, 7, 10, ___?`,\n      `Identify the pattern: 2, 4, 8, 16, ___?`,\n      `What is the next: 81, 64, 49, 36, ___?`,\n      `Find the pattern: 11, 22, 33, 44, ___?`,\n      \n      // Letter sequences\n      `What comes next: A, B, C, D, ___?`,\n      `Find the pattern: A, C, E, G, ___?`,\n      `What is the missing letter: D, E, F, G, ___?`,\n      `Identify the pattern: Z, X, V, T, ___?`,\n      `What comes next: B, D, F, H, ___?`,\n      `Find the sequence: A, B, B, C, C, C, ___?`,\n      `What is the next letter: M, N, O, P, ___?`,\n      `Identify the pattern: A, Z, B, Y, C, ___?`,\n      `What comes next: F, E, D, C, ___?`,\n      `Find the pattern: A, C, F, J, ___?`,\n      \n      // Shape/symbol patterns\n      `What comes next in the pattern: , , , , ___?`,\n      `Find the visual pattern: , , , ___?`,\n      \n      // Mixed patterns\n      `What comes next: 1A, 2B, 3C, 4D, ___?`,\n      `Identify the pattern: A1, A2, B2, B3, C3, ___?`,\n      `Find the sequence: 5a, 10b, 15c, 20d, ___?`,\n      \n      // Logic problems\n      `If the pattern is multiply by 2: 1, 2, 4, 8, ___?`,\n      `If the pattern is add 5 each time: 3, 8, 13, 18, ___?`,\n      `If the pattern is subtract 2: 20, 18, 16, 14, ___?`,\n      `If the pattern doubles then adds 1: 1, 3, 7, 15, ___?`,\n    ],\n  };\n\n  const questions = questionsMap[operation] || questionsMap.addition;\n  return questions[Math.floor(Math.random() * questions.length)];\n};\n\nconst getWeakTopics = (history) => {\n  if (!history || history.length === 0) return [];\n  \n  const accuracy = {};\n  history.forEach(log => {\n    const op = log.operation || 'addition';\n    if (!accuracy[op]) accuracy[op] = { correct: 0, total: 0 };\n    accuracy[op].total++;\n    if (log.correct) accuracy[op].correct++;\n  });\n\n  return Object.entries(accuracy)\n    .map(([op, data]) => ({ op, rate: data.correct / data.total }))\n    .sort((a, b) => a.rate - b.rate)\n    .map(item => item.op);\n};\n\nexport { generateQuestion, getWeakTopics };\n","import React, { useState, useEffect, useRef } from 'react';\nimport { generateQuestion } from '../services/aiService';\nimport { saveAnswer, getUserAnswerHistory } from '../services/databaseService';\nimport { calculateGradeAwareDifficulty } from '../data/mathModules';\nimport { awardXP, getLevelTitle } from '../services/xpService';\n\nconst TEST_QUESTION_COUNT = 10;\nconst AUTO_ADVANCE_DELAY = 1800; // ms after correct answer before auto-advance\n\n/** Parse user input that may be a fraction like \"1/2\", mixed number, or plain number */\nconst parseFractionInput = (input) => {\n  const trimmed = (input || '').toString().trim();\n  if (!trimmed) return NaN;\n\n  // Mixed number: \"1 1/2\" -> 1.5\n  const mixedMatch = trimmed.match(/^(\\d+)\\s+(\\d+)\\s*\\/\\s*(\\d+)$/);\n  if (mixedMatch) {\n    const whole = parseInt(mixedMatch[1]);\n    const num = parseInt(mixedMatch[2]);\n    const den = parseInt(mixedMatch[3]);\n    return den !== 0 ? whole + num / den : NaN;\n  }\n\n  // Simple fraction: \"1/2\", \"3/4\"\n  const fractionMatch = trimmed.match(/^(-?\\d+)\\s*\\/\\s*(\\d+)$/);\n  if (fractionMatch) {\n    const num = parseInt(fractionMatch[1]);\n    const den = parseInt(fractionMatch[2]);\n    return den !== 0 ? num / den : NaN;\n  }\n\n  // Plain number or decimal\n  return parseFloat(trimmed);\n};\n\nexport default function QuestionCard({ userId, userGrade, mode, selectedModules, onNext, onEndSession, onXPUpdate }) {\n  const [question, setQuestion] = useState('');\n  const [operation, setOperation] = useState('');\n  const [userAnswer, setUserAnswer] = useState('');\n  const [correctAnswer, setCorrectAnswer] = useState(null);\n  const [feedback, setFeedback] = useState('');\n  const [isCorrect, setIsCorrect] = useState(null);\n  const [loading, setLoading] = useState(true);\n  const [showHint, setShowHint] = useState(false);\n  const [sessionStats, setSessionStats] = useState({ correct: 0, total: 0, difficulty: 'Medium' });\n  const [questionsInSession, setQuestionsInSession] = useState(0);\n  // Test mode state\n  const [elapsedTime, setElapsedTime] = useState(0);\n  const [missedQuestions, setMissedQuestions] = useState([]);\n  const [showSummary, setShowSummary] = useState(false);\n  const [showCelebration, setShowCelebration] = useState(false);\n  const [showPlaySummary, setShowPlaySummary] = useState(false);\n  const [loadError, setLoadError] = useState(false);\n  const timerRef = useRef(null);\n\n  // Phase 2: Engagement state\n  const [currentStreak, setCurrentStreak] = useState(0);\n  const [xpEarnedPopup, setXpEarnedPopup] = useState(null); // { xp, streak, leveledUp, newLevel }\n  const [sessionXP, setSessionXP] = useState(0);\n  const [showLevelUp, setShowLevelUp] = useState(false);\n  const [newLevelInfo, setNewLevelInfo] = useState(null);\n  const [isSubmitting, setIsSubmitting] = useState(false);\n  const autoAdvanceRef = useRef(null);\n  const historyRef = useRef(null);\n\n  useEffect(() => {\n    loadQuestion();\n    return () => {\n      if (autoAdvanceRef.current) clearTimeout(autoAdvanceRef.current);\n    };\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, []);\n\n  // Timer for test mode\n  useEffect(() => {\n    if (mode === 'test' && !showSummary) {\n      timerRef.current = setInterval(() => {\n        setElapsedTime(prev => prev + 1);\n      }, 1000);\n      return () => clearInterval(timerRef.current);\n    }\n  }, [mode, showSummary]);\n\n  const getOperationsFromModules = () => {\n    // Map module names to operations\n    // Note: Some module names appear in multiple grades (e.g., \"Geometry\", \"Algebra\")\n    // JS objects deduplicate keys, so shared names naturally resolve\n    const moduleToOps = {\n      // KG-1 modules\n      'Addition': ['addition'],\n      'Subtraction': ['subtraction'],\n      'Multiplication': ['multiplication'],\n      'Division': ['division'],\n      'Fractions': ['fractions'],\n      'Logic & Patterns': ['logic_patterns'],\n      \n      // 2-3 modules\n      'Arithmetic Operations': ['addition', 'subtraction', 'multiplication', 'division'],\n      'Fractions & Decimals': ['fractions', 'decimals'],\n      'Variables & Equations': ['algebra'],\n      \n      // Shared across grades\n      'Geometry': ['geometry'],\n      'Algebra': ['algebra'],\n      'Arithmetic': ['addition', 'subtraction', 'multiplication', 'division'],\n      'Statistics & Probability': ['statistics'],\n      \n      // 6-7 modules\n      'Arithmetic & Number Theory': ['addition', 'subtraction', 'multiplication', 'division'],\n      'Fractions, Decimals & Percentages': ['fractions', 'decimals'],\n      'Pre-Algebra': ['algebra'],\n      'Advanced Reasoning': ['logic_patterns'],\n      \n      // 7-8 modules\n      'Functions & Graphing': ['algebra'],\n      'Geometry & Trigonometry': ['geometry'],\n      'Exponents & Roots': ['addition'],  // Handled specially by exponent answer calculator\n      \n      // 9+ modules\n      'Functions & Analysis': ['algebra', 'calculus'],\n      'Calculus Basics': ['calculus'],\n      'Mathematical Reasoning': ['logic_patterns'],\n    };\n    \n    if (!selectedModules || selectedModules.length === 0) {\n      return ['addition', 'subtraction', 'multiplication', 'division'];\n    }\n    \n    const ops = new Set();\n    selectedModules.forEach(module => {\n      const moduleOps = moduleToOps[module] || ['addition', 'subtraction', 'multiplication', 'division'];\n      moduleOps.forEach(op => ops.add(op));\n    });\n    \n    return Array.from(ops);\n  };\n\n  const loadQuestion = async () => {\n    setLoading(true);\n    setLoadError(false);\n    try {\n      // Get user history for adaptive questions (cached per session)\n      let history = [];\n      if (mode === 'play') {\n        if (!historyRef.current) {\n          historyRef.current = await getUserAnswerHistory(userId);\n        }\n        history = historyRef.current;\n      }\n      \n      // Get available operations from selected modules\n      const availableOps = getOperationsFromModules();\n      \n      // Select operation\n      const op = mode === 'play' \n        ? getAdaptiveOperation(history, availableOps) \n        : getRandomOperation(availableOps);\n      \n      setOperation(op);\n\n      // Generate question with selected modules\n      // generateQuestion returns { question: string, answer: number|string|null }\n      const result = await generateQuestion(history, userGrade, op, selectedModules);\n      const q = result.question;\n      setQuestion(q);\n\n      // Use AI-provided answer if available, otherwise fall back to local calculation\n      const answer = result.answer !== null && result.answer !== undefined\n        ? result.answer\n        : calculateAnswer(q, op);\n      setCorrectAnswer(answer);\n    } catch (error) {\n      console.error('Error loading question:', error);\n      setLoadError(true);\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const getAdaptiveOperation = (history, operations) => {\n    if (operations.length === 0) operations = ['addition', 'subtraction', 'multiplication', 'division'];\n\n    if (history.length === 0) {\n      return operations[Math.floor(Math.random() * operations.length)];\n    }\n\n    // Prioritize weak areas\n    const accuracy = {};\n    history.forEach(log => {\n      const op = log.operation || 'addition';\n      if (!accuracy[op]) accuracy[op] = { correct: 0, total: 0 };\n      accuracy[op].total++;\n      if (log.correct) accuracy[op].correct++;\n    });\n\n    const weakOps = Object.entries(accuracy)\n      .filter(([op]) => operations.includes(op))\n      .sort(([, a], [, b]) => (a.correct / a.total) - (b.correct / b.total))\n      .map(([op]) => op);\n\n    // 70% chance for weak area, 30% for random\n    if (weakOps.length > 0 && Math.random() < 0.7) {\n      return weakOps[0];\n    }\n\n    return operations[Math.floor(Math.random() * operations.length)];\n  };\n\n  const getRandomOperation = (operations) => {\n    if (operations.length === 0) operations = ['addition', 'subtraction', 'multiplication', 'division'];\n    return operations[Math.floor(Math.random() * operations.length)];\n  };\n\n  const calculateAnswer = (question, op) => {\n    // For special operation types (algebra, geometry, etc), extract answer from question\n    if (op === 'algebra' || op === 'algebra_problem') {\n      // Examples: \"If 2x + 5 = 13, what is x?\" -> 4\n      // \"Solve: 3x - 7 = 8\" -> 5\n      if (question.includes('2x + 5 = 13')) return 4;\n      if (question.includes('3x - 7 = 8')) return 5;\n      if (question.includes('y = 2x') && question.includes('x = 5')) return 10;\n      if (question.includes('4x + 2x')) return 0; // Simplified form is \"6x\"\n      if (question.includes('5x = 25')) return 5;\n      if (question.includes('x/2 = 10')) return 20;\n      if (question.includes('2x + 4 = 12')) return 4;\n      if (question.includes('3x = 21')) return 7;\n      if (question.includes('x + 8 = 15')) return 7;\n      // Try to solve algebraic equations from AI-generated questions\n      // Pattern: \"Ax + B = C\" or \"Ax - B = C\" where A may be implicit (1)\n      // Also handles \"x + B = C\" and \"x - B = C\"\n      const algebraPattern = /(\\d*)x\\s*([+-])\\s*(\\d+)\\s*=\\s*(\\d+)/;\n      const algebraMatch = question.match(algebraPattern);\n      if (algebraMatch) {\n        const A = algebraMatch[1] ? parseInt(algebraMatch[1]) : 1;\n        const op2 = algebraMatch[2];\n        const B = parseInt(algebraMatch[3]);\n        const C = parseInt(algebraMatch[4]);\n        if (op2 === '+') {\n          return (C - B) / A;\n        } else if (op2 === '-') {\n          return (C + B) / A;\n        }\n      }\n      // Pattern: \"Ax = C\" (no +/- term)\n      const simpleAlgebra = /(\\d*)x\\s*=\\s*(\\d+)/;\n      const simpleMatch = question.match(simpleAlgebra);\n      if (simpleMatch) {\n        const A = simpleMatch[1] ? parseInt(simpleMatch[1]) : 1;\n        const C = parseInt(simpleMatch[2]);\n        return C / A;\n      }\n      // Extract numbers for simple algebra\n      const numbers = question.match(/\\d+/g);\n      if (numbers && numbers.length >= 2) {\n        return parseInt(numbers[numbers.length - 1]);\n      }\n    }\n    \n    if (op === 'geometry' || op === 'geometry_problem') {\n      // Examples: \"area of rectangle 8cm  5cm\" -> 40\n      if (question.includes('8') && question.includes('5') && question.includes('area') && question.includes('rectangle')) return 40;\n      if (question.includes('6') && question.includes('perimeter') && question.includes('square')) return 24;\n      if (question.includes('10') && question.includes('6') && question.includes('triangle')) return 30;\n      if (question.includes('5') && question.includes('circumference')) return 31.4;\n      if (question.includes('24') && question.includes('4')) return 6;\n      if (question.includes('side 3') && question.includes('volume')) return 27;\n      if (question.includes('diameter 10')) return 5;\n      if (question.includes('side 7') && question.includes('area') && question.includes('square')) return 49;\n      \n      // Try to extract dimensions and calculate area\n      if ((question.includes('area') || question.includes('Area')) && question.includes('rectangle')) {\n        const dimensions = question.match(/(\\d+)\\s*(?:cm|m)?\\s*(?:|x|by)\\s*(\\d+)/);\n        if (dimensions) {\n          return parseInt(dimensions[1]) * parseInt(dimensions[2]);\n        }\n      }\n      \n      if ((question.includes('perimeter') || question.includes('Perimeter')) && question.includes('rectangle')) {\n        const dimensions = question.match(/(\\d+)\\s*(?:cm|m)?\\s*(?:|x|by)\\s*(\\d+)/);\n        if (dimensions) {\n          return 2 * (parseInt(dimensions[1]) + parseInt(dimensions[2]));\n        }\n      }\n      \n      const numbers = question.match(/\\d+/g);\n      if (numbers && numbers.length >= 2) {\n        return parseInt(numbers[0]) * parseInt(numbers[1]);\n      }\n    }\n    \n    if (op === 'statistics' || op === 'statistics_problem') {\n      // Examples: \"probability of getting 3 on die\" -> 0.17\n      if (question.includes('die') && question.includes('3')) return 0.17;\n      if (question.includes('mean') && question.includes('2') && question.includes('4') && question.includes('6') && question.includes('8')) return 5;\n      if (question.includes('coin') && question.includes('heads')) return 0.5;\n      if (question.includes('3') && question.includes('5') && question.includes('median')) return 7;\n      if (question.includes('red') && question.includes('5') && question.includes('3')) return 0.63;\n      \n      // Try to calculate mean from numbers\n      if (question.includes('mean') || question.includes('Mean')) {\n        const numbers = question.match(/\\d+/g);\n        if (numbers && numbers.length >= 2) {\n          const sum = numbers.reduce((a, b) => parseInt(a) + parseInt(b), 0);\n          return Math.round((sum / numbers.length) * 100) / 100;\n        }\n      }\n      \n      return null; // Cannot determine answer for this statistics question\n    }\n    \n    if (op === 'calculus' || op === 'calculus_problem') {\n      // Examples: \"derivative of x\" -> 2x (but we need numeric)\n      if (question.includes('x')) return 2;\n      if (question.includes('3x')) return 6;\n      if (question.includes('5x')) return 15;\n      if (question.includes('2')) return 1;\n      return 1;\n    }\n\n    // Handle exponents and roots (for Exponents & Roots module)\n    // Patterns: \"What is 2?\", \"What is 144?\", \"2^5\", \"2\", \"64\", \"27\"\n    const superscriptMap = { '': 0, '': 1, '': 2, '': 3, '': 4, '': 5, '': 6, '': 7, '': 8, '': 9 };\n    \n    // Square root: 144, 81, sqrt(144)\n    const sqrtMatch = question.match(/(\\d+)/);\n    if (sqrtMatch) {\n      const val = parseInt(sqrtMatch[1]);\n      const root = Math.sqrt(val);\n      if (Number.isInteger(root)) return root;\n      return Math.round(root * 100) / 100;\n    }\n\n    // Cube root: 27, 64\n    const cbrtMatch = question.match(/(\\d+)/);\n    if (cbrtMatch) {\n      const val = parseInt(cbrtMatch[1]);\n      const root = Math.cbrt(val);\n      if (Number.isInteger(root)) return root;\n      return Math.round(root * 100) / 100;\n    }\n\n    // Exponent with caret: 2^5, 3^4\n    const caretMatch = question.match(/(\\d+)\\s*\\^\\s*(\\d+)/);\n    if (caretMatch) {\n      return Math.pow(parseInt(caretMatch[1]), parseInt(caretMatch[2]));\n    }\n\n    // Exponent with superscript: 2, 3, 10\n    const superscriptPattern = /(\\d+)([]+)/;\n    const superMatch = question.match(superscriptPattern);\n    if (superMatch) {\n      const base = parseInt(superMatch[1]);\n      const expStr = superMatch[2];\n      let exp = 0;\n      for (const ch of expStr) {\n        exp = exp * 10 + (superscriptMap[ch] || 0);\n      }\n      return Math.pow(base, exp);\n    }\n\n    // \"x to the power of y\" pattern\n    const powerMatch = question.match(/(\\d+)\\s*to the power (?:of\\s*)?(\\d+)/i);\n    if (powerMatch) {\n      return Math.pow(parseInt(powerMatch[1]), parseInt(powerMatch[2]));\n    }\n\n    // \"square root of X\"\n    const sqrtWordMatch = question.match(/square root (?:of\\s*)?(\\d+)/i);\n    if (sqrtWordMatch) {\n      const val = parseInt(sqrtWordMatch[1]);\n      const root = Math.sqrt(val);\n      if (Number.isInteger(root)) return root;\n      return Math.round(root * 100) / 100;\n    }\n\n    // \"cube root of X\"\n    const cbrtWordMatch = question.match(/cube root (?:of\\s*)?(\\d+)/i);\n    if (cbrtWordMatch) {\n      const val = parseInt(cbrtWordMatch[1]);\n      const root = Math.cbrt(val);\n      if (Number.isInteger(root)) return root;\n      return Math.round(root * 100) / 100;\n    }\n\n    // Exponent multiplication: \"2  2\" or \"3  3\" -> same base, add exponents\n    const expMulMatch = question.match(/(\\d+)([]+)\\s*[x]\\s*(\\d+)([]+)/);\n    if (expMulMatch) {\n      const base1 = parseInt(expMulMatch[1]);\n      const exp1Str = expMulMatch[2];\n      const base2 = parseInt(expMulMatch[3]);\n      const exp2Str = expMulMatch[4];\n      let exp1 = 0, exp2 = 0;\n      for (const ch of exp1Str) exp1 = exp1 * 10 + (superscriptMap[ch] || 0);\n      for (const ch of exp2Str) exp2 = exp2 * 10 + (superscriptMap[ch] || 0);\n      if (base1 === base2) {\n        return Math.pow(base1, exp1 + exp2);\n      }\n      return Math.pow(base1, exp1) * Math.pow(base2, exp2);\n    }\n\n    if (op === 'logic_patterns' || op === 'logic_patterns_problem') {\n      // Handle letter sequence patterns (A, B, C, D, ___)\n      const letterMatch = question.match(/[A-Za-z],\\s*[A-Za-z],\\s*[A-Za-z]/);\n      if (letterMatch) {\n        // Extract letters from the pattern\n        const letters = question.match(/[A-Za-z]/g);\n        if (letters && letters.length >= 2) {\n          const firstLetter = letters[0].toUpperCase();\n          const secondLetter = letters[1].toUpperCase();\n          const diff = secondLetter.charCodeAt(0) - firstLetter.charCodeAt(0);\n          \n          // Find the last letter in the sequence\n          let lastLetter = letters[letters.length - 1].toUpperCase();\n          let nextCharCode = lastLetter.charCodeAt(0) + diff;\n          \n          // Make sure we stay within A-Z range\n          if (nextCharCode <= 90) {\n            return String.fromCharCode(nextCharCode);\n          }\n        }\n        return 'E'; // Default for A, B, C, D sequence\n      }\n      \n      // Handle numeric patterns\n      if (question.includes('2, 4, 6, 8')) return 10;\n      if (question.includes('1, 1, 2, 3, 5, 8')) return 13;\n      if (question.includes('5, 5, 10, 15, 25')) return 40;  // Fibonacci-like: 15+25=40\n      if (question.includes('5, 10, 15, ___') || question.includes('5, 10, 15, _,')) return 20;\n      if (question.includes('1, 4, 9, 16')) return 25;\n      if (question.includes('10, 20, 30, 40')) return 50;\n      if (question.includes('3, 6, 9, 12')) return 15;\n      if (question.includes('1, 3, 5, 7')) return 9;\n      if (question.includes('2, 4, 8, 16')) return 32;\n      if (question.includes('1, 4, 7, 10')) return 13;\n      \n      // Smart pattern detection for numeric sequences\n      // Extract ONLY the comma-separated sequence, not stray numbers from description text\n      const seqMatch = question.match(/(\\d+(?:\\s*,\\s*\\d+){2,})/);\n      const numbers = seqMatch ? seqMatch[0].match(/\\d+/g) : question.match(/\\d+/g);\n      if (numbers && numbers.length >= 3) {\n        const nums = numbers.map(n => parseInt(n));\n        \n        // Check for Fibonacci-like: each number = sum of two before it\n        let isFibLike = true;\n        for (let i = 2; i < nums.length; i++) {\n          if (nums[i] !== nums[i-1] + nums[i-2]) {\n            isFibLike = false;\n            break;\n          }\n        }\n        if (isFibLike && nums.length >= 3) {\n          return nums[nums.length - 1] + nums[nums.length - 2];\n        }\n\n        // Check for geometric: each number = previous * ratio\n        if (nums[0] !== 0) {\n          const ratio = nums[1] / nums[0];\n          let isGeometric = ratio !== 1;\n          for (let i = 2; i < nums.length; i++) {\n            if (nums[i-1] === 0 || nums[i] / nums[i-1] !== ratio) {\n              isGeometric = false;\n              break;\n            }\n          }\n          if (isGeometric) {\n            return nums[nums.length - 1] * ratio;\n          }\n        }\n\n        // Check for quadratic (squares): differences of differences are constant\n        if (nums.length >= 3) {\n          const diffs = [];\n          for (let i = 1; i < nums.length; i++) diffs.push(nums[i] - nums[i-1]);\n          const diffs2 = [];\n          for (let i = 1; i < diffs.length; i++) diffs2.push(diffs[i] - diffs[i-1]);\n          const isQuadratic = diffs2.length > 0 && diffs2.every(d => d === diffs2[0]);\n          if (isQuadratic) {\n            const nextDiff = diffs[diffs.length - 1] + diffs2[0];\n            return nums[nums.length - 1] + nextDiff;\n          }\n        }\n\n        // Fallback: arithmetic (constant difference)\n        if (nums.length >= 2) {\n          const lastNum = nums[nums.length - 1];\n          const secondLastNum = nums[nums.length - 2];\n          const diff = lastNum - secondLastNum;\n          return lastNum + diff;\n        }\n      }\n    }\n\n    // Regex patterns for different operations\n    const patterns = {\n      addition: /(\\d+(?:\\.\\d+)?)\\s*\\+\\s*(\\d+(?:\\.\\d+)?)/,\n      subtraction: /(\\d+(?:\\.\\d+)?)\\s*-\\s*(\\d+(?:\\.\\d+)?)/,\n      multiplication: /(\\d+(?:\\.\\d+)?)\\s*[x]\\s*(\\d+(?:\\.\\d+)?)/,\n      division: /(\\d+(?:\\.\\d+)?)\\s*[/]\\s*(\\d+(?:\\.\\d+)?)/,\n      fractions: /(\\d+)\\s*\\/\\s*(\\d+)\\s*[+x/-]\\s*(\\d+)\\s*\\/\\s*(\\d+)/,\n      decimals: /(\\d+(?:\\.\\d+)?)\\s*[+x/-]\\s*(\\d+(?:\\.\\d+)?)/,\n    };\n\n    // Handle chained arithmetic expressions (e.g., \"8 + 5 + 8\", \"10 - 3 - 2\", \"2  3  4\")\n    // This must come BEFORE the simple two-operand pattern matching\n    const chainedAddition = question.match(/(\\d+(?:\\.\\d+)?)(?:\\s*\\+\\s*(\\d+(?:\\.\\d+)?))+/);\n    const chainedSubtraction = question.match(/(\\d+(?:\\.\\d+)?)(?:\\s*-\\s*(\\d+(?:\\.\\d+)?))+/);\n    const chainedMultiplication = question.match(/(\\d+(?:\\.\\d+)?)(?:\\s*[x]\\s*(\\d+(?:\\.\\d+)?))+/);\n\n    if (op === 'addition' && chainedAddition) {\n      const allNumbers = chainedAddition[0].match(/\\d+(?:\\.\\d+)?/g);\n      if (allNumbers && allNumbers.length > 2) {\n        return Math.round(allNumbers.reduce((sum, n) => sum + parseFloat(n), 0) * 100) / 100;\n      }\n    }\n    if (op === 'subtraction' && chainedSubtraction) {\n      const allNumbers = chainedSubtraction[0].match(/\\d+(?:\\.\\d+)?/g);\n      if (allNumbers && allNumbers.length > 2) {\n        return Math.round(allNumbers.slice(1).reduce((result, n) => result - parseFloat(n), parseFloat(allNumbers[0])) * 100) / 100;\n      }\n    }\n    if (op === 'multiplication' && chainedMultiplication) {\n      const allNumbers = chainedMultiplication[0].match(/\\d+(?:\\.\\d+)?/g);\n      if (allNumbers && allNumbers.length > 2) {\n        return Math.round(allNumbers.reduce((product, n) => product * parseFloat(n), 1) * 100) / 100;\n      }\n    }\n\n    // Handle fractions (e.g., \"1/4 + 1/4\")\n    if (op === 'fractions') {\n      // Try to match fraction operations like \"1/4 + 1/4\"\n      const fractionPattern = /(\\d+)\\s*\\/\\s*(\\d+)\\s*([+-])\\s*(\\d+)\\s*\\/\\s*(\\d+)/;\n      const match = question.match(fractionPattern);\n      if (match) {\n        const num1 = parseInt(match[1]);\n        const den1 = parseInt(match[2]);\n        const operator = match[3];\n        const num2 = parseInt(match[4]);\n        const den2 = parseInt(match[5]);\n        \n        if (operator === '+') {\n          // Add fractions: (num1*den2 + num2*den1) / (den1*den2)\n          const resultNum = num1 * den2 + num2 * den1;\n          const resultDen = den1 * den2;\n          return resultNum / resultDen;\n        } else if (operator === '-') {\n          // Subtract fractions\n          const resultNum = num1 * den2 - num2 * den1;\n          const resultDen = den1 * den2;\n          return resultNum / resultDen;\n        }\n      }\n      \n      // Try simple fraction pattern like \"What is 1/2 of 10?\"\n      const simpleFraction = /(\\d+)\\s*\\/\\s*(\\d+)\\s*(?:of|)\\s*(\\d+)/;\n      const match2 = question.match(simpleFraction);\n      if (match2) {\n        const num = parseInt(match2[1]);\n        const den = parseInt(match2[2]);\n        const value = parseInt(match2[3]);\n        return (num / den) * value;\n      }\n\n      // Handle \"If a/b of a number is C, what is the number?\" -> C * b / a\n      const reversePattern = /(\\d+)\\s*\\/\\s*(\\d+)\\s*of\\s*a\\s*number\\s*is\\s*(\\d+)/i;\n      const match3 = question.match(reversePattern);\n      if (match3) {\n        const num = parseInt(match3[1]);\n        const den = parseInt(match3[2]);\n        const result = parseInt(match3[3]);\n        return (result * den) / num;\n      }\n\n      // Handle \"a/b of what number is/equals C?\" -> C * b / a\n      const reversePattern2 = /(\\d+)\\s*\\/\\s*(\\d+)\\s*of\\s*(?:what|which)\\s*number\\s*(?:is|equals|=)\\s*(\\d+)/i;\n      const match4 = question.match(reversePattern2);\n      if (match4) {\n        const num = parseInt(match4[1]);\n        const den = parseInt(match4[2]);\n        const result = parseInt(match4[3]);\n        return (result * den) / num;\n      }\n      \n      // Fallback: look for any numbers\n      const numbers = question.match(/\\d+/g);\n      if (numbers && numbers.length >= 2) {\n        return parseInt(numbers[0]) / parseInt(numbers[1]);\n      }\n    }\n\n    // Handle other operations with the pattern\n    const pattern = patterns[op];\n    if (pattern) {\n      const match = question.match(pattern);\n      if (match) {\n        const a = parseFloat(match[1]);\n        const b = parseFloat(match[2]);\n        switch (op) {\n          case 'addition': return Math.round((a + b) * 100) / 100;\n          case 'subtraction': return Math.round((a - b) * 100) / 100;\n          case 'multiplication': return Math.round((a * b) * 100) / 100;\n          case 'division': return Math.round((a / b) * 100) / 100;\n          case 'decimals': {\n            // Detect actual operator in the question\n            if (question.match(/\\d\\s*[x]\\s*\\d/)) return Math.round((a * b) * 100) / 100;\n            if (question.match(/\\d\\s*[/]\\s*\\d/)) return Math.round((a / b) * 100) / 100;\n            if (question.match(/\\d\\s*-\\s*\\d/)) return Math.round((a - b) * 100) / 100;\n            return Math.round((a + b) * 100) / 100; // default to addition\n          }\n          default: return null;\n        }\n      }\n    }\n\n    // For story problems, look for \"how many\" or similar\n    const numbers = question.match(/\\d+(?:\\.\\d+)?/g);\n    if (numbers && numbers.length >= 2) {\n      const nums = numbers.map(n => parseFloat(n));\n      switch (op) {\n        case 'addition': return Math.round(nums.reduce((a, b) => a + b, 0) * 100) / 100;\n        case 'subtraction': return Math.round(nums.slice(1).reduce((a, b) => a - b, nums[0]) * 100) / 100;\n        case 'multiplication': return Math.round(nums.reduce((a, b) => a * b, 1) * 100) / 100;\n        case 'division': return Math.round((nums[0] / nums[nums.length - 1]) * 100) / 100;\n        case 'decimals': {\n          // Detect actual operator in the question\n          if (question.match(/\\d\\s*[x]\\s*\\d/)) return Math.round(nums.reduce((a, b) => a * b, 1) * 100) / 100;\n          if (question.match(/\\d\\s*[/]\\s*\\d/)) return Math.round((nums[0] / nums[nums.length - 1]) * 100) / 100;\n          if (question.match(/\\d\\s*-\\s*\\d/)) return Math.round(nums.slice(1).reduce((a, b) => a - b, nums[0]) * 100) / 100;\n          return Math.round(nums.reduce((a, b) => a + b, 0) * 100) / 100; // default to addition\n        }\n        default: return null;\n      }\n    }\n\n    return null;\n  };\n\n  const handleSubmit = async (e) => {\n    e.preventDefault();\n    if (isSubmitting || isCorrect !== null) return; // debounce & prevent double submit\n    setIsSubmitting(true);\n    \n    try {\n    // Check if answer was extracted successfully\n    if (correctAnswer === null) {\n      setFeedback(' Unable to extract answer from this question. Please try the next question.');\n      setIsCorrect(false);\n      return;\n    }\n    \n    // Handle different answer types based on operation\n    let correct = false;\n    let userVal = userAnswer;\n    \n    if (operation === 'logic_patterns' || operation === 'logic_patterns_problem') {\n      // For logic patterns, compare as strings (case-insensitive)\n      if (correctAnswer && typeof correctAnswer === 'string') {\n        correct = userVal.toString().trim().toUpperCase() === correctAnswer.toString().toUpperCase();\n      } else if (correctAnswer !== null) {\n        // If correctAnswer is numeric for logic patterns, allow flexible matching\n        correct = userVal.toString().trim().toUpperCase() === correctAnswer.toString().toUpperCase();\n      }\n    } else {\n      // Parse user answer  supports fractions like \"1/2\", mixed numbers like \"1 1/2\", and decimals\n      const parsedUserVal = parseFractionInput(userAnswer);\n      userVal = parsedUserVal;\n      \n      if (isNaN(parsedUserVal)) {\n        setFeedback(' Please enter a valid number (e.g. 42, 0.5, or 1/2).');\n        setIsCorrect(false);\n        return;\n      }\n      \n      // Handle floating point comparison with small tolerance for rounding errors\n      correct = Math.abs(parsedUserVal - correctAnswer) < 0.01 || parsedUserVal === correctAnswer;\n    }\n    \n    setIsCorrect(correct);\n    \n    // Update streak\n    const newStreak = correct ? currentStreak + 1 : 0;\n    setCurrentStreak(newStreak);\n    \n    if (correct) {\n      // Varied success messages for delight\n      const successMessages = [' Correct! Amazing!', ' Nailed it!', ' You\\'re on fire!', ' Brilliant!', ' Super fast!', ' Big brain move!'];\n      const streakMessages = [' Unstoppable streak!', ' On a roll!', ' Can\\'t be stopped!'];\n      const msg = newStreak >= 3\n        ? `${streakMessages[newStreak % streakMessages.length]} (${newStreak} in a row!)`\n        : successMessages[Math.floor(Math.random() * successMessages.length)];\n      setFeedback(msg);\n      setShowCelebration(true);\n      setTimeout(() => setShowCelebration(false), 2000);\n    } else {\n      const explanation = getExplanation(operation, question, correctAnswer);\n      setFeedback(` Not quite.\\n${correctAnswer}\\n${explanation}`);\n    }\n\n    // Update session statistics\n    const newTotal = sessionStats.total + 1;\n    const newCorrect = correct ? sessionStats.correct + 1 : sessionStats.correct;\n    const newDifficulty = calculateDifficulty(newCorrect, newTotal);\n    \n    setSessionStats({\n      correct: newCorrect,\n      total: newTotal,\n      difficulty: newDifficulty,\n    });\n    \n    setQuestionsInSession(questionsInSession + 1);\n\n    // Track missed questions for test summary\n    if (!correct) {\n      setMissedQuestions(prev => [...prev, {\n        question,\n        yourAnswer: userVal,\n        correctAnswer,\n        operation,\n      }]);\n    }\n\n    // Award XP\n    try {\n      const xpResult = await awardXP(userId, {\n        correct,\n        streak: correct ? newStreak : 0,\n        difficulty: newDifficulty,\n      });\n\n      if (xpResult.xpEarned > 0) {\n        setSessionXP(prev => prev + xpResult.xpEarned);\n        setXpEarnedPopup({\n          xp: xpResult.xpEarned,\n          streak: newStreak,\n          leveledUp: xpResult.leveledUp,\n          newLevel: xpResult.level,\n        });\n        setTimeout(() => setXpEarnedPopup(null), 2200);\n\n        // Level up notification\n        if (xpResult.leveledUp) {\n          setNewLevelInfo({ level: xpResult.level, title: getLevelTitle(xpResult.level) });\n          setShowLevelUp(true);\n          setTimeout(() => setShowLevelUp(false), 3500);\n        }\n      }\n\n      // Notify parent of XP changes\n      if (onXPUpdate) onXPUpdate(xpResult);\n    } catch (error) {\n      console.error('Error awarding XP:', error);\n    }\n\n    // Save to database\n    try {\n      await saveAnswer(userId, {\n        question,\n        operation,\n        userAnswer: userVal,\n        correctAnswer,\n        correct,\n      });\n    } catch (error) {\n      console.error('Error saving answer:', error);\n    }\n\n    // Auto-advance after correct answer (play mode only)\n    if (correct && mode === 'play') {\n      autoAdvanceRef.current = setTimeout(() => {\n        handleNextQuestion();\n      }, AUTO_ADVANCE_DELAY);\n    }\n    } finally {\n      setIsSubmitting(false);\n    }\n  };\n\n  const handleNextQuestion = () => {\n    // Clear any pending auto-advance\n    if (autoAdvanceRef.current) {\n      clearTimeout(autoAdvanceRef.current);\n      autoAdvanceRef.current = null;\n    }\n    // In test mode, check if we've reached the question limit\n    if (mode === 'test' && sessionStats.total >= TEST_QUESTION_COUNT) {\n      clearInterval(timerRef.current);\n      setShowSummary(true);\n      return;\n    }\n    setUserAnswer('');\n    setIsCorrect(null);\n    setFeedback('');\n    setShowHint(false);\n    setShowCelebration(false);\n    setXpEarnedPopup(null);\n    loadQuestion();\n    if (onNext) onNext();\n  };\n\n  const calculateDifficulty = (correct, total) => {\n    const result = calculateGradeAwareDifficulty(correct, total, userGrade);\n    return result.difficulty;\n  };\n\n  const getHintForOperation = (op, q) => {\n    const hints = {\n      addition: [\n        'Break big numbers into tens and ones, then add each part separately.',\n        'Try adding the ones digits first, then the tens.',\n        'Line up the numbers by place value and add column by column.',\n      ],\n      subtraction: [\n        'Try counting up from the smaller number to the larger one.',\n        'Break the problem into smaller steps  subtract the ones first, then the tens.',\n        'If the top digit is smaller, you may need to borrow from the next column.',\n      ],\n      multiplication: [\n        'Multiplication is repeated addition. For example, 4  3 = 4 + 4 + 4.',\n        'Break one number into parts: 12  5 = (10  5) + (2  5).',\n        'Look for patterns in your times tables to help.',\n      ],\n      division: [\n        'Division is the opposite of multiplication. Think: what times the divisor gives the dividend?',\n        'Try estimating first  is the answer closer to 5 or 50?',\n        'Break the dividend into friendly parts that divide evenly.',\n      ],\n      fractions: [\n        'To add fractions, make sure the denominators (bottom numbers) are the same first.',\n        'Remember: \"of\" means multiply. So 1/3 of 12 = (1/3)  12.',\n        'To simplify a fraction, divide top and bottom by the same number.',\n      ],\n      decimals: [\n        'Line up the decimal points before adding or subtracting.',\n        'When multiplying decimals, count total decimal places in both numbers.',\n        'Think of decimals as money  0.5 is like 50 cents.',\n      ],\n      algebra: [\n        'To solve for x, do the same operation to both sides of the equation.',\n        'Work backwards: if 2x + 5 = 13, first subtract 5, then divide by 2.',\n        'Replace the variable with your answer to check if both sides are equal.',\n      ],\n      geometry: [\n        'Area of a rectangle = length  width. Perimeter = 2  (length + width).',\n        'Area of a triangle = (base  height)  2.',\n        'For circles: circumference =   diameter, area =   radius.',\n      ],\n      statistics: [\n        'Mean = sum of all values  number of values.',\n        'Median is the middle value when numbers are sorted in order.',\n        'Probability = favorable outcomes  total possible outcomes.',\n      ],\n      calculus: [\n        'The derivative of x is n  x (power rule).',\n        'A derivative tells you the rate of change  how fast something changes.',\n        'For limits, try plugging the value directly into the expression first.',\n      ],\n      logic_patterns: [\n        'Look at the differences between consecutive numbers  is there a pattern?',\n        'Check if each number is multiplied by the same value (geometric pattern).',\n        'Try checking if each number is the sum of the two before it (like Fibonacci).',\n      ],\n    };\n\n    const opHints = hints[op] || hints.addition;\n    return opHints[Math.floor(Math.random() * opHints.length)];\n  };\n\n  const getExplanation = (op, q, answer) => {\n    const explanations = {\n      addition: `Tip: Add numbers step by step. Break large numbers into tens and ones.`,\n      subtraction: `Tip: Subtract by counting up from the smaller number, or break into parts.`,\n      multiplication: `Tip: Multiplication is repeated addition. You can also break numbers into parts: e.g. 125 = (105)+(25).`,\n      division: `Tip: Think \"what number times the divisor gives the dividend?\" Division is the reverse of multiplication.`,\n      fractions: `Tip: For fraction operations, find a common denominator first. \"Of\" means multiply: a/b of X = (aX)/b.`,\n      decimals: `Tip: Line up decimal points for +/. For , multiply as whole numbers then count decimal places.`,\n      algebra: `Tip: Isolate the variable by doing the same operation to both sides. Work backwards from the result.`,\n      geometry: `Tip: Rectangle area = lw, triangle = bh, circle = r. Perimeter = sum of all sides.`,\n      statistics: `Tip: Mean = sumcount. Median = middle value when sorted. Probability = favorabletotal outcomes.`,\n      calculus: `Tip: Power rule: d/dx(x) = nx. For limits, try direct substitution first.`,\n      logic_patterns: `Tip: Check differences between terms (arithmetic), ratios (geometric), or sums of previous terms (Fibonacci-like).`,\n    };\n    return explanations[op] || 'Tip: Review the question carefully and try breaking it into smaller steps.';\n  };\n  const formatTime = (seconds) => {\n    const mins = Math.floor(seconds / 60);\n    const secs = seconds % 60;\n    return `${mins}:${secs.toString().padStart(2, '0')}`;\n  };\n\n  // Play Mode Summary Screen\n  if (showPlaySummary) {\n    const pct = sessionStats.total > 0 ? Math.round((sessionStats.correct / sessionStats.total) * 100) : 0;\n    const emoji = pct >= 80 ? '' : pct >= 60 ? '' : pct >= 40 ? '' : '';\n\n    return (\n      <div className=\"min-h-[calc(100vh-120px)] flex items-center justify-center p-4\">\n      <div className=\"max-w-lg w-full bg-white rounded-2xl p-6 shadow-xl animate-fade-in\">\n        <div className=\"text-center mb-6\">\n          <h2 className=\"text-3xl font-bold text-gray-800 mb-2\">{emoji} Session Complete!</h2>\n          <p className=\"text-gray-500\">Great practice session  here's your recap</p>\n        </div>\n\n        <div className=\"grid grid-cols-2 sm:grid-cols-4 gap-3 mb-6\">\n          <div className=\"bg-violet-50 rounded-xl p-3 text-center\">\n            <p className=\"text-2xl font-bold text-violet-600\">{sessionStats.total}</p>\n            <p className=\"text-xs text-gray-500 mt-1\">Questions</p>\n          </div>\n          <div className=\"bg-green-50 rounded-xl p-3 text-center\">\n            <p className=\"text-2xl font-bold text-green-600\">{sessionStats.correct}</p>\n            <p className=\"text-xs text-gray-500 mt-1\">Correct</p>\n          </div>\n          <div className=\"bg-purple-50 rounded-xl p-3 text-center\">\n            <p className=\"text-2xl font-bold text-purple-600\">{pct}%</p>\n            <p className=\"text-xs text-gray-500 mt-1\">Accuracy</p>\n          </div>\n          <div className=\"bg-amber-50 rounded-xl p-3 text-center\">\n            <p className=\"text-2xl font-bold text-amber-600\">+{sessionXP}</p>\n            <p className=\"text-xs text-gray-500 mt-1\">XP Earned</p>\n          </div>\n        </div>\n\n        {missedQuestions.length > 0 && (\n          <div className=\"mb-6\">\n            <h3 className=\"font-bold text-gray-800 mb-3\"> Questions to Review ({missedQuestions.length})</h3>\n            <div className=\"space-y-3 max-h-60 overflow-y-auto\">\n              {missedQuestions.map((mq, i) => (\n                <div key={i} className=\"bg-red-50 border-l-4 border-red-400 p-3 rounded-r-lg text-sm\">\n                  <p className=\"font-semibold text-gray-800 mb-1\">{mq.question}</p>\n                  <p className=\"text-red-600\">Your answer: {mq.yourAnswer}</p>\n                  <p className=\"text-green-600\">Correct answer: {mq.correctAnswer}</p>\n                </div>\n              ))}\n            </div>\n          </div>\n        )}\n\n        {missedQuestions.length === 0 && sessionStats.total > 0 && (\n          <div className=\"bg-green-50 border-l-4 border-green-400 p-4 rounded-r-lg mb-6 text-center\">\n            <p className=\"text-lg font-bold text-green-700\"> All correct! Outstanding!</p>\n          </div>\n        )}\n\n        <button\n          onClick={onEndSession}\n          className=\"w-full bg-gradient-to-r from-violet-500 to-purple-600 text-white font-bold py-3 min-h-[44px] rounded-lg hover:shadow-lg transform hover:scale-105 transition\"\n        >\n           Back to Modules\n        </button>\n      </div>\n      </div>\n    );\n  }\n\n  // Test Summary Screen\n  if (showSummary) {\n    const pct = sessionStats.total > 0 ? Math.round((sessionStats.correct / sessionStats.total) * 100) : 0;\n    const grade = pct >= 90 ? 'A+' : pct >= 80 ? 'A' : pct >= 70 ? 'B' : pct >= 60 ? 'C' : pct >= 50 ? 'D' : 'F';\n    const gradeColor = pct >= 80 ? 'text-green-600' : pct >= 60 ? 'text-yellow-600' : 'text-red-600';\n\n    return (\n      <div className=\"min-h-[calc(100vh-120px)] flex items-center justify-center p-4\">\n      <div className=\"max-w-lg w-full bg-white rounded-2xl p-6 shadow-xl animate-fade-in\">\n        <div className=\"text-center mb-6\">\n          <h2 className=\"text-3xl font-bold text-gray-800 mb-2\"> Test Complete!</h2>\n          <p className=\"text-gray-500\">Here's how you did</p>\n        </div>\n\n        {/* Score Card */}\n        <div className=\"grid grid-cols-2 sm:grid-cols-4 gap-3 mb-6\">\n          <div className=\"bg-violet-50 rounded-xl p-3 text-center\">\n            <p className=\"text-2xl font-bold text-violet-600\">{sessionStats.correct}/{sessionStats.total}</p>\n            <p className=\"text-xs text-gray-500 mt-1\">Correct</p>\n          </div>\n          <div className=\"bg-purple-50 rounded-xl p-3 text-center\">\n            <p className={`text-2xl font-bold ${gradeColor}`}>{grade}</p>\n            <p className=\"text-xs text-gray-500 mt-1\">{pct}%</p>\n          </div>\n          <div className=\"bg-amber-50 rounded-xl p-3 text-center\">\n            <p className=\"text-2xl font-bold text-amber-600\">{formatTime(elapsedTime)}</p>\n            <p className=\"text-xs text-gray-500 mt-1\">Time</p>\n          </div>\n          <div className=\"bg-emerald-50 rounded-xl p-3 text-center\">\n            <p className=\"text-2xl font-bold text-emerald-600\">+{sessionXP}</p>\n            <p className=\"text-xs text-gray-500 mt-1\">XP Earned</p>\n          </div>\n        </div>\n\n        {/* Missed Questions Review */}\n        {missedQuestions.length > 0 && (\n          <div className=\"mb-6\">\n            <h3 className=\"font-bold text-gray-800 mb-3\"> Questions to Review ({missedQuestions.length})</h3>\n            <div className=\"space-y-3 max-h-60 overflow-y-auto\">\n              {missedQuestions.map((mq, i) => (\n                <div key={i} className=\"bg-red-50 border-l-4 border-red-400 p-3 rounded-r-lg text-sm\">\n                  <p className=\"font-semibold text-gray-800 mb-1\">{mq.question}</p>\n                  <p className=\"text-red-600\">Your answer: {mq.yourAnswer}</p>\n                  <p className=\"text-green-600\">Correct answer: {mq.correctAnswer}</p>\n                </div>\n              ))}\n            </div>\n          </div>\n        )}\n\n        {missedQuestions.length === 0 && (\n          <div className=\"bg-green-50 border-l-4 border-green-400 p-4 rounded-r-lg mb-6 text-center\">\n            <p className=\"text-lg font-bold text-green-700\"> Perfect Score! Amazing work!</p>\n          </div>\n        )}\n\n        <button\n          onClick={onEndSession}\n          className=\"w-full bg-gradient-to-r from-violet-500 to-purple-600 text-white font-bold py-3 min-h-[44px] rounded-lg hover:shadow-lg transform hover:scale-105 transition\"\n        >\n           Back to Modules\n        </button>\n      </div>\n      </div>\n    );\n  }\n\n  if (loading) {\n    return (\n      <div className=\"max-w-xl mx-auto bg-gradient-to-br from-violet-50 to-purple-50 rounded-xl p-6 shadow-lg\">\n        {/* Skeleton: header */}\n        <div className=\"flex justify-between items-center mb-4\">\n          <div className=\"flex gap-2\">\n            <div className=\"skeleton h-6 w-28 rounded-full\" />\n            <div className=\"skeleton h-6 w-20 rounded-full\" />\n          </div>\n          <div className=\"skeleton h-9 w-24 rounded-lg\" />\n        </div>\n        {/* Skeleton: question counter */}\n        <div className=\"skeleton h-5 w-48 mx-auto mb-3 rounded\" />\n        {/* Skeleton: question box */}\n        <div className=\"bg-white rounded-lg p-4 mb-4 border-2 border-gray-200\">\n          <div className=\"skeleton h-6 w-full mb-2 rounded\" />\n          <div className=\"skeleton h-6 w-3/4 mx-auto rounded\" />\n        </div>\n        {/* Skeleton: input */}\n        <div className=\"skeleton h-12 w-full mb-4 rounded-lg\" />\n        {/* Skeleton: button */}\n        <div className=\"skeleton h-12 w-full rounded-lg\" />\n      </div>\n    );\n  }\n\n  // Error state with retry\n  if (loadError) {\n    return (\n      <div className=\"max-w-xl mx-auto bg-gradient-to-br from-amber-50 to-orange-50 rounded-xl p-8 shadow-lg text-center\">\n        <div className=\"text-5xl mb-4\"></div>\n        <h2 className=\"text-xl font-bold text-gray-800 mb-2\">Oops! Couldn't load the question</h2>\n        <p className=\"text-gray-600 mb-6\">Don't worry  just try again or head back to modules.</p>\n        <div className=\"flex gap-3 justify-center\">\n          <button\n            onClick={loadQuestion}\n            className=\"px-6 py-3 min-h-[44px] bg-gradient-to-r from-violet-500 to-purple-600 text-white font-bold rounded-lg hover:shadow-lg transform hover:scale-105 transition\"\n          >\n             Try Again\n          </button>\n          <button\n            onClick={onEndSession}\n            className=\"px-6 py-3 min-h-[44px] bg-gray-200 text-gray-700 font-bold rounded-lg hover:bg-gray-300 transition\"\n          >\n             Back to Modules\n          </button>\n        </div>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"max-w-xl mx-auto bg-gradient-to-br from-violet-50 to-purple-50 rounded-xl p-6 shadow-lg\">\n      {/* Session Header with Difficulty & End Button */}\n      <div className=\"flex justify-between items-center mb-4\">\n        <div className=\"flex items-center gap-2 flex-wrap\">\n          <div className=\"text-sm font-semibold text-gray-600\">\n            Operation: <span className=\"text-violet-600 capitalize\">{operation}</span>\n          </div>\n          <div className={`px-3 py-1 rounded-full text-white text-sm font-bold ${\n            sessionStats.difficulty === 'Very Hard' ? 'bg-red-600' :\n            sessionStats.difficulty === 'Hard' ? 'bg-orange-600' :\n            sessionStats.difficulty === 'Medium' ? 'bg-yellow-600' :\n            sessionStats.difficulty === 'Easy' ? 'bg-green-600' :\n            'bg-green-500'\n          }`}>\n             {sessionStats.difficulty}\n          </div>\n          {/* Streak Counter */}\n          {currentStreak >= 2 && (\n            <div className=\"px-3 py-1 rounded-full bg-gradient-to-r from-orange-400 to-red-500 text-white text-sm font-bold animate-bounce-slow flex items-center gap-1\">\n               {currentStreak} streak\n            </div>\n          )}\n        </div>\n        <button\n          onClick={() => {\n            if (autoAdvanceRef.current) clearTimeout(autoAdvanceRef.current);\n            const hasProgress = sessionStats.total > 0;\n            if (hasProgress && !window.confirm('End this session? Your progress will be saved.')) return;\n            if (mode === 'play' && hasProgress) {\n              setShowPlaySummary(true);\n            } else {\n              onEndSession();\n            }\n          }}\n          className=\"px-4 py-2 min-h-[44px] bg-red-500 text-white text-sm font-semibold rounded-lg hover:bg-red-600 transition\"\n          title=\"End this practice/test session\"\n        >\n          End Session\n        </button>\n      </div>\n\n      {/* Question Counter */}\n      <div className=\"text-center mb-2 text-sm font-semibold text-gray-600\">\n        {mode === 'test' ? (\n          <div className=\"flex justify-between items-center\">\n            <span>Question {Math.min(sessionStats.total + 1, TEST_QUESTION_COUNT)}/{TEST_QUESTION_COUNT}</span>\n            <span> {sessionStats.correct}/{sessionStats.total}</span>\n            <span> {formatTime(elapsedTime)}</span>\n          </div>\n        ) : (\n          <>Questions: {sessionStats.total} | Correct: {sessionStats.correct} ({sessionStats.total > 0 ? Math.round((sessionStats.correct / sessionStats.total) * 100) : 0}%)</>\n        )}\n      </div>\n\n      {/* Question */}\n      <div className={`bg-white rounded-lg p-4 mb-4 border-2 border-violet-300 ${isCorrect === false ? 'animate-shake' : ''}`}>\n        <h2 className=\"text-xl font-bold text-gray-800 text-center\">{question}</h2>\n      </div>\n\n      {/* Form */}\n      <form onSubmit={handleSubmit} className=\"space-y-4\">\n        <div>\n          <label className=\"block text-sm font-semibold text-gray-700 mb-2\">Your Answer:</label>\n          <input\n            type=\"text\"\n            inputMode={operation === 'logic_patterns' || operation === 'logic_patterns_problem' ? 'text' : 'decimal'}\n            value={userAnswer}\n            onChange={(e) => setUserAnswer(e.target.value)}\n            placeholder={operation === 'logic_patterns' || operation === 'logic_patterns_problem' ? 'Enter letter (A, B, C, etc)' : 'Enter your answer (e.g. 42 or 0.5)'}\n            className=\"w-full p-3 border-2 border-violet-400 rounded-lg text-lg font-semibold focus:outline-none focus:border-violet-600 focus:ring-2 focus:ring-violet-200 transition disabled:opacity-50 disabled:bg-gray-100\"\n            disabled={isCorrect !== null}\n            autoFocus\n          />\n        </div>\n\n        {/* Hint Button */}\n        {isCorrect === null && (\n          <button\n            type=\"button\"\n            onClick={() => setShowHint(!showHint)}\n            className=\"text-sm text-violet-600 hover:text-violet-800 font-semibold underline\"\n          >\n            {showHint ? ' Hint Shown' : '? Need a hint?'}\n          </button>\n        )}\n\n        {/* Hint */}\n        {showHint && isCorrect === null && (\n          <div className=\"bg-yellow-100 border-l-4 border-yellow-500 p-3 rounded text-sm text-gray-700\">\n             {getHintForOperation(operation, question)}\n          </div>\n        )}\n\n        {/* Submit Button */}\n        <button\n          type=\"submit\"\n          disabled={isCorrect !== null || !userAnswer}\n          className=\"w-full bg-gradient-to-r from-emerald-400 to-teal-500 text-white font-bold py-3 min-h-[44px] rounded-lg disabled:opacity-50 hover:shadow-lg transform hover:scale-105 transition\"\n        >\n          Submit Answer \n        </button>\n      </form>\n\n      {/* Celebration Animation  confetti with horizontal spread */}\n      {showCelebration && (\n        <div className=\"fixed inset-0 pointer-events-none z-50 overflow-hidden\">\n          {/* Brief screen flash */}\n          <div className=\"absolute inset-0 bg-white animate-correct-flash\" />\n          {[...Array(currentStreak >= 5 ? 40 : currentStreak >= 3 ? 30 : 20)].map((_, i) => {\n            const sizes = ['text-lg', 'text-2xl', 'text-3xl'];\n            const drift = Math.round((Math.random() - 0.5) * 200);\n            return (\n              <div\n                key={i}\n                className={`absolute animate-confetti ${sizes[i % 3]}`}\n                style={{\n                  left: `${Math.random() * 100}%`,\n                  '--x-drift': `${drift}px`,\n                  animationDelay: `${Math.random() * 0.5}s`,\n                  animationDuration: `${1.5 + Math.random()}s`,\n                }}\n              >\n                {['', '', '', '', '', ''][i % 6]}\n              </div>\n            );\n          })}\n        </div>\n      )}\n\n      {/* XP Earned Popup */}\n      {xpEarnedPopup && (\n        <div className=\"flex justify-center mt-3 animate-xp-popup\">\n          <div className=\"inline-flex items-center gap-2 px-4 py-2 rounded-full bg-gradient-to-r from-amber-400 to-orange-500 text-white font-bold shadow-lg\">\n            <span className=\"text-lg\"></span>\n            <span>+{xpEarnedPopup.xp} XP</span>\n            {xpEarnedPopup.streak >= 3 && (\n              <span className=\"text-xs bg-white bg-opacity-30 rounded-full px-2 py-0.5\">\n                 {xpEarnedPopup.streak}x\n              </span>\n            )}\n          </div>\n        </div>\n      )}\n\n      {/* Level Up Overlay */}\n      {showLevelUp && newLevelInfo && (\n        <div className=\"fixed inset-0 z-50 flex items-center justify-center pointer-events-none\">\n          <div className=\"bg-white rounded-2xl p-8 shadow-2xl text-center animate-level-up border-4 border-amber-400 max-w-sm mx-4\">\n            <div className=\"text-6xl mb-3\"></div>\n            <h2 className=\"text-2xl font-bold text-gray-800 mb-1\">Level Up!</h2>\n            <p className=\"text-4xl font-bold text-violet-600 mb-2\">Level {newLevelInfo.level}</p>\n            <p className=\"text-lg text-amber-600 font-semibold\">{newLevelInfo.title}</p>\n          </div>\n        </div>\n      )}\n\n      {/* Feedback */}\n      {feedback && (\n        <div aria-live=\"assertive\" role=\"alert\" className={`mt-4 p-4 rounded-lg font-bold animate-slide-in ${\n          isCorrect \n            ? 'bg-green-100 text-green-700 border-2 border-green-400 text-center text-lg' \n            : 'bg-red-50 text-red-700 border-2 border-red-400'\n        }`}>\n          {isCorrect ? (\n            feedback\n          ) : (\n            <>\n              <p className=\"text-center text-base mb-2\">{feedback.split('\\n')[0]}</p>\n              <div className=\"text-center py-2 px-4 bg-white rounded-lg border border-green-300 mb-2\">\n                <span className=\"text-sm text-gray-500 block\">Correct answer:</span>\n                <span className=\"text-2xl font-bold text-green-600\">{feedback.split('\\n')[1]}</span>\n              </div>\n              <p className=\"text-sm font-medium text-red-500 opacity-80 text-center\">{feedback.split('\\n')[2]}</p>\n            </>\n          )}\n        </div>\n      )}\n\n      {/* Auto-advance indicator (play mode, correct answer) */}\n      {isCorrect === true && mode === 'play' && (\n        <div className=\"mt-2 text-center text-sm text-gray-400 font-medium animate-pulse\">\n          Next question in a moment...\n        </div>\n      )}\n\n      {/* Next Button */}\n      {isCorrect !== null && (\n        <button\n          onClick={handleNextQuestion}\n          className=\"w-full mt-3 bg-gradient-to-r from-amber-400 to-orange-500 text-white font-bold py-3 min-h-[44px] rounded-lg hover:shadow-lg transform hover:scale-105 transition\"\n        >\n          {isCorrect && mode === 'play' ? 'Skip Ahead ' : 'Next Question '}\n        </button>\n      )}\n    </div>\n  );\n}\n","/**\n * Challenge / Multiplayer Service\n *\n * Firestore collection: \"challenges\"\n * Document schema:\n *   {\n *     code: string,              // 6-char alphanumeric join code\n *     creatorId: string,\n *     creatorName: string,\n *     opponentId: string | null,\n *     opponentName: string | null,\n *     grade: string,             // e.g. '2-3'\n *     modules: string[],         // selected module names\n *     questions: Array<{ question: string, answer: string|number, operation: string }>,\n *     status: 'waiting' | 'active' | 'completed',\n *     creatorAnswers: Array<{ answer: string, correct: boolean, timeMs: number }>,\n *     opponentAnswers: Array<{ answer: string, correct: boolean, timeMs: number }>,\n *     createdAt: Timestamp,\n *     startedAt: Timestamp | null,\n *     completedAt: Timestamp | null,\n *   }\n */\n\nimport { db } from '../firebaseConfig';\nimport {\n  collection,\n  doc,\n  setDoc,\n  getDoc,\n  updateDoc,\n  query,\n  where,\n  getDocs,\n  onSnapshot,\n  serverTimestamp,\n} from 'firebase/firestore';\n\nconst CHALLENGES_COL = 'challenges';\nconst CHALLENGE_QUESTION_COUNT = 5;\n\n//  Helpers \n\n/** Generate a 6-character alphanumeric code (uppercase) */\nfunction generateCode() {\n  const chars = 'ABCDEFGHJKLMNPQRSTUVWXYZ23456789'; // no I/O/0/1 for readability\n  let code = '';\n  for (let i = 0; i < 6; i++) {\n    code += chars[Math.floor(Math.random() * chars.length)];\n  }\n  return code;\n}\n\n//  Create Challenge \n\n/**\n * Create a new challenge and return the challenge document data.\n * The creator pre-generates questions so both players get the same set.\n *\n * @param {string} userId\n * @param {string} userName\n * @param {string} grade           e.g. '2-3'\n * @param {string[]} modules       selected module names\n * @param {Function} questionGenerator  async (grade, modules) => Array<{question, answer, operation}>\n * @returns {{ id: string, code: string, ...rest }}\n */\nexport const createChallenge = async (userId, userName, grade, modules, questionGenerator) => {\n  const code = generateCode();\n  const id = `challenge_${code}_${Date.now()}`;\n\n  // Generate questions\n  const questions = await questionGenerator(grade, modules, CHALLENGE_QUESTION_COUNT);\n\n  const challengeDoc = {\n    code,\n    creatorId: userId,\n    creatorName: userName,\n    opponentId: null,\n    opponentName: null,\n    grade,\n    modules,\n    questions,\n    status: 'waiting',\n    creatorAnswers: [],\n    opponentAnswers: [],\n    createdAt: serverTimestamp(),\n    startedAt: null,\n    completedAt: null,\n  };\n\n  await setDoc(doc(db, CHALLENGES_COL, id), challengeDoc);\n  return { id, ...challengeDoc };\n};\n\n//  Join Challenge \n\n/**\n * Join an existing challenge by code.\n * Returns the challenge data or throws if not found / already full.\n */\nexport const joinChallenge = async (code, userId, userName) => {\n  const q = query(\n    collection(db, CHALLENGES_COL),\n    where('code', '==', code.toUpperCase()),\n    where('status', '==', 'waiting')\n  );\n  const snap = await getDocs(q);\n\n  if (snap.empty) {\n    throw new Error('Challenge not found or already started.');\n  }\n\n  const challengeDoc = snap.docs[0];\n  const data = challengeDoc.data();\n\n  if (data.creatorId === userId) {\n    throw new Error(\"You can't join your own challenge!\");\n  }\n\n  await updateDoc(doc(db, CHALLENGES_COL, challengeDoc.id), {\n    opponentId: userId,\n    opponentName: userName,\n    status: 'active',\n    startedAt: serverTimestamp(),\n  });\n\n  return { id: challengeDoc.id, ...data, opponentId: userId, opponentName: userName, status: 'active' };\n};\n\n//  Submit Answer \n\n/**\n * Submit an answer for the current question.\n *\n * @param {string} challengeId\n * @param {string} role  'creator' | 'opponent'\n * @param {{ answer: string, correct: boolean, timeMs: number }} answerData\n */\nexport const submitChallengeAnswer = async (challengeId, role, answerData) => {\n  const ref = doc(db, CHALLENGES_COL, challengeId);\n  const snap = await getDoc(ref);\n  if (!snap.exists()) throw new Error('Challenge not found');\n\n  const data = snap.data();\n  const field = role === 'creator' ? 'creatorAnswers' : 'opponentAnswers';\n  const currentAnswers = data[field] || [];\n  const updatedAnswers = [...currentAnswers, answerData];\n\n  const updates = { [field]: updatedAnswers };\n\n  // Check if both players have finished\n  const otherField = role === 'creator' ? 'opponentAnswers' : 'creatorAnswers';\n  const otherAnswers = data[otherField] || [];\n  if (updatedAnswers.length >= data.questions.length && otherAnswers.length >= data.questions.length) {\n    updates.status = 'completed';\n    updates.completedAt = serverTimestamp();\n  }\n\n  await updateDoc(ref, updates);\n  return updates;\n};\n\n//  Get Challenge \n\nexport const getChallenge = async (challengeId) => {\n  const ref = doc(db, CHALLENGES_COL, challengeId);\n  const snap = await getDoc(ref);\n  if (!snap.exists()) return null;\n  return { id: snap.id, ...snap.data() };\n};\n\n//  Real-time Listener \n\n/**\n * Subscribe to real-time updates on a challenge document.\n * Returns an unsubscribe function.\n */\nexport const onChallengeUpdate = (challengeId, callback) => {\n  const ref = doc(db, CHALLENGES_COL, challengeId);\n  return onSnapshot(ref, (snap) => {\n    if (snap.exists()) {\n      callback({ id: snap.id, ...snap.data() });\n    }\n  });\n};\n\nexport { CHALLENGE_QUESTION_COUNT };\n","import React, { useState, useEffect, useRef, useCallback } from 'react';\nimport {\n  createChallenge,\n  joinChallenge,\n  submitChallengeAnswer,\n  onChallengeUpdate,\n  CHALLENGE_QUESTION_COUNT,\n} from '../services/challengeService';\nimport { generateQuestion } from '../services/aiService';\n\n/**\n * ChallengeMode  Multiplayer challenge flow.\n *\n * Screens:\n *   1. Lobby   Create (get code) or Join (enter code)\n *   2. Waiting  Creator waits for opponent to join\n *   3. Game    Both players answer same questions, live opponent progress\n *   4. Results  Side-by-side comparison\n */\n\n//  Helper: parse answer for numeric comparison \n\nfunction parseAnswer(str) {\n  if (str == null) return NaN;\n  const s = String(str).trim();\n  // fraction e.g. \"3/4\"\n  if (/^-?\\d+\\/\\d+$/.test(s)) {\n    const [n, d] = s.split('/').map(Number);\n    return d !== 0 ? n / d : NaN;\n  }\n  return parseFloat(s);\n}\n\nfunction answersMatch(userAnswer, correctAnswer) {\n  const u = String(userAnswer).trim().toLowerCase();\n  const c = String(correctAnswer).trim().toLowerCase();\n  if (u === c) return true;\n  const uNum = parseAnswer(u);\n  const cNum = parseAnswer(c);\n  if (!isNaN(uNum) && !isNaN(cNum)) return Math.abs(uNum - cNum) < 0.01;\n  return false;\n}\n\n//  Question generator for challenges \n\nconst MODULE_TO_OPS = {\n  Addition: ['addition'],\n  Subtraction: ['subtraction'],\n  Multiplication: ['multiplication'],\n  Division: ['division'],\n  Fractions: ['fractions'],\n  'Logic & Patterns': ['logic_patterns'],\n  'Arithmetic Operations': ['addition', 'subtraction', 'multiplication', 'division'],\n  'Fractions & Decimals': ['fractions', 'decimals'],\n  'Variables & Equations': ['algebra'],\n  Geometry: ['geometry'],\n  Algebra: ['algebra'],\n  Arithmetic: ['addition', 'subtraction', 'multiplication', 'division'],\n  'Statistics & Probability': ['statistics'],\n  'Arithmetic & Number Theory': ['addition', 'subtraction', 'multiplication', 'division'],\n  'Fractions, Decimals & Percentages': ['fractions', 'decimals'],\n  'Pre-Algebra': ['algebra'],\n  'Advanced Reasoning': ['logic_patterns'],\n  'Functions & Graphing': ['algebra'],\n  'Geometry & Trigonometry': ['geometry'],\n  'Exponents & Roots': ['addition'],\n  'Functions & Analysis': ['algebra', 'calculus'],\n  'Calculus Basics': ['calculus'],\n  'Mathematical Reasoning': ['logic_patterns'],\n};\n\nasync function generateChallengeQuestions(grade, modules, count) {\n  const ops = new Set();\n  modules.forEach(m => {\n    (MODULE_TO_OPS[m] || ['addition']).forEach(o => ops.add(o));\n  });\n  const opsArr = Array.from(ops);\n\n  const questions = [];\n  for (let i = 0; i < count; i++) {\n    const op = opsArr[Math.floor(Math.random() * opsArr.length)];\n    try {\n      const { question, answer } = await generateQuestion([], grade, op, modules);\n      questions.push({ question, answer: answer != null ? String(answer) : '', operation: op });\n    } catch {\n      questions.push({ question: `What is ${i + 2} + ${i + 3}?`, answer: String(i + 5), operation: 'addition' });\n    }\n  }\n  return questions;\n}\n\n//  Component \n\nexport default function ChallengeMode({ userId, userName, userGrade, selectedModules, onBack }) {\n  // Screens: 'lobby' | 'waiting' | 'game' | 'results'\n  const [screen, setScreen] = useState('lobby');\n  const [challengeData, setChallengeData] = useState(null);\n  const [joinCode, setJoinCode] = useState('');\n  const [error, setError] = useState('');\n  const [loading, setLoading] = useState(false);\n  const [role, setRole] = useState(null); // 'creator' | 'opponent'\n\n  // Game state\n  const [currentQ, setCurrentQ] = useState(0);\n  const [userAnswer, setUserAnswer] = useState('');\n  const [feedback, setFeedback] = useState(null);\n  const [myAnswers, setMyAnswers] = useState([]);\n  const [opponentProgress, setOpponentProgress] = useState(0);\n  const [questionStartTime, setQuestionStartTime] = useState(Date.now());\n\n  const unsubRef = useRef(null);\n  const inputRef = useRef(null);\n\n  //  Real-time listener \n  const startListening = useCallback((challengeId, myRole) => {\n    if (unsubRef.current) unsubRef.current();\n    unsubRef.current = onChallengeUpdate(challengeId, (data) => {\n      setChallengeData(data);\n\n      // Track opponent progress\n      const opField = myRole === 'creator' ? 'opponentAnswers' : 'creatorAnswers';\n      setOpponentProgress((data[opField] || []).length);\n\n      // Creator in waiting  opponent joined  start game\n      if (myRole === 'creator' && data.status === 'active' && data.opponentId) {\n        setScreen('game');\n        setQuestionStartTime(Date.now());\n      }\n\n      // Challenge completed\n      if (data.status === 'completed') {\n        setScreen('results');\n      }\n    });\n  }, []);\n\n  // Cleanup listener on unmount\n  useEffect(() => {\n    return () => {\n      if (unsubRef.current) unsubRef.current();\n    };\n  }, []);\n\n  // Focus input when question changes\n  useEffect(() => {\n    if (screen === 'game' && inputRef.current) {\n      inputRef.current.focus();\n    }\n  }, [screen, currentQ]);\n\n  //  Create Challenge \n  const handleCreate = async () => {\n    setError('');\n    setLoading(true);\n    try {\n      const challenge = await createChallenge(\n        userId, userName, userGrade, selectedModules,\n        generateChallengeQuestions\n      );\n      setChallengeData(challenge);\n      setRole('creator');\n      setScreen('waiting');\n      startListening(challenge.id, 'creator');\n    } catch (e) {\n      setError(e.message);\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  //  Join Challenge \n  const handleJoin = async () => {\n    if (!joinCode.trim()) { setError('Enter a challenge code'); return; }\n    setError('');\n    setLoading(true);\n    try {\n      const challenge = await joinChallenge(joinCode.trim(), userId, userName);\n      setChallengeData(challenge);\n      setRole('opponent');\n      setScreen('game');\n      setQuestionStartTime(Date.now());\n      startListening(challenge.id, 'opponent');\n    } catch (e) {\n      setError(e.message);\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  //  Submit Answer \n  const handleSubmit = async (e) => {\n    e.preventDefault();\n    if (!userAnswer.trim() || !challengeData || feedback) return;\n\n    const q = challengeData.questions[currentQ];\n    const correct = answersMatch(userAnswer, q.answer);\n    const timeMs = Date.now() - questionStartTime;\n\n    const answerData = { answer: userAnswer.trim(), correct, timeMs };\n\n    setFeedback({ correct, correctAnswer: q.answer });\n    setMyAnswers(prev => [...prev, answerData]);\n\n    try {\n      await submitChallengeAnswer(challengeData.id, role, answerData);\n    } catch (err) {\n      console.error('Failed to submit challenge answer:', err);\n    }\n\n    // Advance to next question after delay\n    setTimeout(() => {\n      if (currentQ + 1 < challengeData.questions.length) {\n        setCurrentQ(prev => prev + 1);\n        setUserAnswer('');\n        setFeedback(null);\n        setQuestionStartTime(Date.now());\n      }\n      // If last question, the real-time listener will detect completion\n    }, 1200);\n  };\n\n  //  Computed results \n  const getResults = () => {\n    if (!challengeData) return null;\n    const ca = challengeData.creatorAnswers || [];\n    const oa = challengeData.opponentAnswers || [];\n    const creatorScore = ca.filter(a => a.correct).length;\n    const opponentScore = oa.filter(a => a.correct).length;\n    const creatorTime = ca.reduce((s, a) => s + (a.timeMs || 0), 0);\n    const opponentTime = oa.reduce((s, a) => s + (a.timeMs || 0), 0);\n    return {\n      creatorName: challengeData.creatorName,\n      opponentName: challengeData.opponentName,\n      creatorScore, opponentScore,\n      creatorTime, opponentTime,\n      totalQuestions: challengeData.questions.length,\n      questions: challengeData.questions,\n      creatorAnswers: ca,\n      opponentAnswers: oa,\n    };\n  };\n\n  //  RENDER: Lobby \n  if (screen === 'lobby') {\n    return (\n      <div className=\"min-h-[calc(100vh-120px)] flex items-center justify-center p-4\">\n        <div className=\"max-w-md w-full bg-white rounded-2xl p-8 shadow-xl animate-fade-in\">\n          <div className=\"text-center mb-6\">\n            <h2 className=\"text-3xl font-bold text-gray-800 mb-2\"> Challenge Mode</h2>\n            <p className=\"text-gray-500 text-sm\">Challenge a friend to the same questions!</p>\n          </div>\n\n          {/* Create */}\n          <button\n            onClick={handleCreate}\n            disabled={loading || !selectedModules || selectedModules.length === 0}\n            className=\"w-full bg-gradient-to-r from-violet-500 to-purple-600 text-white font-bold py-4 rounded-xl mb-4 hover:shadow-lg transform hover:scale-105 transition disabled:opacity-50 text-lg\"\n          >\n            {loading ? ' Creating...' : ' Create Challenge'}\n          </button>\n          {(!selectedModules || selectedModules.length === 0) && (\n            <p className=\"text-xs text-gray-400 text-center -mt-2 mb-3\">\n              Select modules first to create a challenge\n            </p>\n          )}\n\n          <div className=\"flex items-center gap-3 my-4\">\n            <div className=\"flex-1 h-px bg-gray-200\" />\n            <span className=\"text-gray-400 text-sm font-semibold\">OR</span>\n            <div className=\"flex-1 h-px bg-gray-200\" />\n          </div>\n\n          {/* Join */}\n          <div className=\"space-y-3\">\n            <input\n              type=\"text\"\n              value={joinCode}\n              onChange={e => setJoinCode(e.target.value.toUpperCase())}\n              placeholder=\"Enter 6-digit code\"\n              maxLength={6}\n              className=\"w-full p-4 border-2 border-violet-300 rounded-xl text-center text-2xl font-mono tracking-widest focus:outline-none focus:border-violet-600 focus:ring-2 focus:ring-violet-200 uppercase\"\n            />\n            <button\n              onClick={handleJoin}\n              disabled={loading || joinCode.length < 6}\n              className=\"w-full bg-gradient-to-r from-amber-400 to-orange-500 text-white font-bold py-4 rounded-xl hover:shadow-lg transform hover:scale-105 transition disabled:opacity-50 text-lg\"\n            >\n              {loading ? ' Joining...' : ' Join Challenge'}\n            </button>\n          </div>\n\n          {error && (\n            <div className=\"mt-4 p-3 bg-red-50 border border-red-200 rounded-lg text-red-700 text-sm font-semibold text-center\">\n              {error}\n            </div>\n          )}\n\n          <button\n            onClick={onBack}\n            className=\"w-full mt-6 py-3 text-gray-500 font-semibold hover:text-gray-700 transition\"\n          >\n             Back to Modules\n          </button>\n        </div>\n      </div>\n    );\n  }\n\n  //  RENDER: Waiting for Opponent \n  if (screen === 'waiting') {\n    return (\n      <div className=\"min-h-[calc(100vh-120px)] flex items-center justify-center p-4\">\n        <div className=\"max-w-md w-full bg-white rounded-2xl p-8 shadow-xl animate-fade-in text-center\">\n          <div className=\"text-5xl mb-4 animate-bounce\"></div>\n          <h2 className=\"text-2xl font-bold text-gray-800 mb-2\">Waiting for Opponent</h2>\n          <p className=\"text-gray-500 mb-6\">Share this code with your friend:</p>\n\n          <div className=\"bg-gradient-to-r from-violet-100 to-purple-100 rounded-2xl p-6 mb-6\">\n            <p className=\"text-4xl font-mono font-bold text-violet-700 tracking-[0.3em] select-all\">\n              {challengeData?.code}\n            </p>\n          </div>\n\n          <p className=\"text-sm text-gray-400 mb-6\">\n            {CHALLENGE_QUESTION_COUNT} questions  {selectedModules.join(', ')}\n          </p>\n\n          <div className=\"flex items-center justify-center gap-2 text-violet-600 animate-pulse\">\n            <svg className=\"w-5 h-5 animate-spin\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n              <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15\" />\n            </svg>\n            <span className=\"font-semibold\">Listening for opponent...</span>\n          </div>\n\n          <button\n            onClick={() => { if (unsubRef.current) unsubRef.current(); setScreen('lobby'); }}\n            className=\"mt-8 py-3 px-6 text-gray-500 font-semibold hover:text-gray-700 transition\"\n          >\n             Cancel\n          </button>\n        </div>\n      </div>\n    );\n  }\n\n  //  RENDER: Game \n  if (screen === 'game' && challengeData) {\n    const q = challengeData.questions[currentQ];\n    const isLastQ = currentQ + 1 >= challengeData.questions.length;\n    const myProgress = myAnswers.length;\n    const totalQ = challengeData.questions.length;\n\n    return (\n      <div className=\"max-w-xl mx-auto p-4\">\n        <div className=\"bg-white rounded-2xl p-6 shadow-xl animate-fade-in\">\n          {/* Header */}\n          <div className=\"flex justify-between items-center mb-4\">\n            <div className=\"text-sm font-semibold text-gray-600\">\n              Question <span className=\"text-violet-600\">{currentQ + 1}/{totalQ}</span>\n            </div>\n            <div className=\"flex items-center gap-3 text-xs\">\n              <span className=\"px-2 py-1 rounded-full bg-violet-100 text-violet-700 font-bold\">\n                You: {myAnswers.filter(a => a.correct).length}/{myProgress}\n              </span>\n              <span className=\"px-2 py-1 rounded-full bg-amber-100 text-amber-700 font-bold\">\n                {role === 'creator' ? challengeData.opponentName : challengeData.creatorName}: {opponentProgress}/{totalQ}\n              </span>\n            </div>\n          </div>\n\n          {/* Progress bars */}\n          <div className=\"space-y-2 mb-4\">\n            <div>\n              <div className=\"flex justify-between text-xs font-semibold text-gray-500 mb-1\">\n                <span>You</span>\n                <span>{Math.round((myProgress / totalQ) * 100)}%</span>\n              </div>\n              <div className=\"w-full h-2 bg-gray-200 rounded-full overflow-hidden\">\n                <div\n                  className=\"h-full bg-gradient-to-r from-violet-400 to-purple-600 rounded-full transition-all duration-500\"\n                  style={{ width: `${(myProgress / totalQ) * 100}%` }}\n                />\n              </div>\n            </div>\n            <div>\n              <div className=\"flex justify-between text-xs font-semibold text-gray-500 mb-1\">\n                <span>Opponent</span>\n                <span>{Math.round((opponentProgress / totalQ) * 100)}%</span>\n              </div>\n              <div className=\"w-full h-2 bg-gray-200 rounded-full overflow-hidden\">\n                <div\n                  className=\"h-full bg-gradient-to-r from-amber-400 to-orange-500 rounded-full transition-all duration-500\"\n                  style={{ width: `${(opponentProgress / totalQ) * 100}%` }}\n                />\n              </div>\n            </div>\n          </div>\n\n          {/* Question */}\n          {q ? (\n            <>\n              <div className={`bg-gradient-to-r from-violet-50 to-purple-50 rounded-xl p-5 mb-4 border-2 border-violet-200 ${feedback && !feedback.correct ? 'animate-shake' : ''}`}>\n                <h3 className=\"text-xl font-bold text-gray-800 text-center\">{q.question}</h3>\n              </div>\n\n              <form onSubmit={handleSubmit} className=\"space-y-4\">\n                <input\n                  ref={inputRef}\n                  type=\"text\"\n                  inputMode=\"decimal\"\n                  value={userAnswer}\n                  onChange={e => setUserAnswer(e.target.value)}\n                  placeholder=\"Your answer...\"\n                  disabled={!!feedback}\n                  className=\"w-full p-4 border-2 border-violet-400 rounded-xl text-lg font-semibold text-center focus:outline-none focus:border-violet-600 focus:ring-2 focus:ring-violet-200 transition disabled:opacity-50 disabled:bg-gray-100\"\n                  autoFocus\n                />\n\n                {!feedback && (\n                  <button\n                    type=\"submit\"\n                    disabled={!userAnswer.trim()}\n                    className=\"w-full bg-gradient-to-r from-emerald-400 to-teal-500 text-white font-bold py-3 rounded-xl hover:shadow-lg transform hover:scale-105 transition disabled:opacity-50\"\n                  >\n                    Submit \n                  </button>\n                )}\n              </form>\n\n              {/* Feedback */}\n              {feedback && (\n                <div aria-live=\"assertive\" role=\"alert\" className={`mt-4 p-4 rounded-xl font-bold text-center ${\n                  feedback.correct\n                    ? 'bg-green-100 text-green-700 border-2 border-green-400'\n                    : 'bg-red-50 text-red-700 border-2 border-red-400'\n                }`}>\n                  {feedback.correct ? ' Correct!' : ` Wrong  answer: ${feedback.correctAnswer}`}\n                  {isLastQ && myAnswers.length >= totalQ && (\n                    <p className=\"text-sm mt-2 opacity-70\">\n                      {opponentProgress < totalQ ? 'Waiting for opponent to finish...' : 'Both finished!'}\n                    </p>\n                  )}\n                </div>\n              )}\n            </>\n          ) : (\n            <div className=\"text-center py-8\">\n              <div className=\"text-4xl animate-pulse mb-3\"></div>\n              <p className=\"text-gray-500 font-semibold\">\n                You're done! Waiting for opponent to finish...\n              </p>\n              <p className=\"text-sm text-gray-400 mt-2\">\n                Opponent progress: {opponentProgress}/{totalQ}\n              </p>\n            </div>\n          )}\n        </div>\n      </div>\n    );\n  }\n\n  //  RENDER: Results \n  if (screen === 'results' && challengeData) {\n    const r = getResults();\n    if (!r) return null;\n\n    const iAmCreator = role === 'creator';\n    const myScore = iAmCreator ? r.creatorScore : r.opponentScore;\n    const theirScore = iAmCreator ? r.opponentScore : r.creatorScore;\n    const myTime = iAmCreator ? r.creatorTime : r.opponentTime;\n    const theirTime = iAmCreator ? r.opponentTime : r.creatorTime;\n    const myName = iAmCreator ? r.creatorName : r.opponentName;\n    const theirName = iAmCreator ? r.opponentName : r.creatorName;\n    const myAns = iAmCreator ? r.creatorAnswers : r.opponentAnswers;\n    const theirAns = iAmCreator ? r.opponentAnswers : r.creatorAnswers;\n\n    const iWon = myScore > theirScore || (myScore === theirScore && myTime < theirTime);\n    const tie = myScore === theirScore && Math.abs(myTime - theirTime) < 500;\n\n    return (\n      <div className=\"min-h-[calc(100vh-120px)] flex items-center justify-center p-4\">\n        <div className=\"max-w-lg w-full bg-white rounded-2xl p-6 shadow-xl animate-fade-in\">\n          {/* Winner banner */}\n          <div className=\"text-center mb-6\">\n            <div className=\"text-5xl mb-2\">{tie ? '' : iWon ? '' : ''}</div>\n            <h2 className=\"text-2xl font-bold text-gray-800\">\n              {tie ? \"It's a Tie!\" : iWon ? 'You Win!' : `${theirName} Wins!`}\n            </h2>\n          </div>\n\n          {/* Score comparison */}\n          <div className=\"grid grid-cols-3 gap-2 mb-6 text-center\">\n            <div className={`rounded-xl p-4 ${iWon ? 'bg-violet-100 border-2 border-violet-400' : 'bg-gray-50'}`}>\n              <p className=\"text-sm font-semibold text-gray-500 mb-1 truncate\">{myName} (You)</p>\n              <p className=\"text-3xl font-bold text-violet-600\">{myScore}</p>\n              <p className=\"text-xs text-gray-400\">{(myTime / 1000).toFixed(1)}s</p>\n            </div>\n            <div className=\"flex items-center justify-center\">\n              <span className=\"text-3xl font-bold text-gray-300\">vs</span>\n            </div>\n            <div className={`rounded-xl p-4 ${!iWon && !tie ? 'bg-amber-100 border-2 border-amber-400' : 'bg-gray-50'}`}>\n              <p className=\"text-sm font-semibold text-gray-500 mb-1 truncate\">{theirName}</p>\n              <p className=\"text-3xl font-bold text-amber-600\">{theirScore}</p>\n              <p className=\"text-xs text-gray-400\">{(theirTime / 1000).toFixed(1)}s</p>\n            </div>\n          </div>\n\n          {/* Stat cards */}\n          <div className=\"grid grid-cols-2 gap-3 mb-6\">\n            <div className=\"bg-violet-50 rounded-lg p-3 text-center\">\n              <p className=\"text-xs text-gray-500\">Your Accuracy</p>\n              <p className=\"text-xl font-bold text-violet-600\">\n                {r.totalQuestions > 0 ? Math.round((myScore / r.totalQuestions) * 100) : 0}%\n              </p>\n            </div>\n            <div className=\"bg-amber-50 rounded-lg p-3 text-center\">\n              <p className=\"text-xs text-gray-500\">Their Accuracy</p>\n              <p className=\"text-xl font-bold text-amber-600\">\n                {r.totalQuestions > 0 ? Math.round((theirScore / r.totalQuestions) * 100) : 0}%\n              </p>\n            </div>\n          </div>\n\n          {/* Question-by-question breakdown */}\n          <div className=\"mb-6\">\n            <h3 className=\"font-bold text-gray-700 mb-3 text-sm\">Question Breakdown</h3>\n            <div className=\"space-y-2 max-h-60 overflow-y-auto\">\n              {r.questions.map((q, i) => (\n                <div key={i} className=\"flex items-center gap-2 p-2 bg-gray-50 rounded-lg text-sm\">\n                  <span className=\"text-gray-400 font-mono w-5\">{i + 1}.</span>\n                  <span className=\"flex-1 truncate text-gray-700\">{q.question}</span>\n                  <span className={`w-6 text-center ${myAns[i]?.correct ? 'text-green-600' : 'text-red-500'}`}>\n                    {myAns[i]?.correct ? '' : ''}\n                  </span>\n                  <span className={`w-6 text-center ${theirAns[i]?.correct ? 'text-green-600' : 'text-red-500'}`}>\n                    {theirAns[i]?.correct ? '' : ''}\n                  </span>\n                </div>\n              ))}\n            </div>\n            <div className=\"flex justify-end gap-4 mt-1 text-xs text-gray-400\">\n              <span>You</span>\n              <span>Them</span>\n            </div>\n          </div>\n\n          {/* Actions */}\n          <div className=\"space-y-3\">\n            <button\n              onClick={() => {\n                if (unsubRef.current) unsubRef.current();\n                setChallengeData(null);\n                setMyAnswers([]);\n                setCurrentQ(0);\n                setUserAnswer('');\n                setFeedback(null);\n                setOpponentProgress(0);\n                setScreen('lobby');\n                setError('');\n              }}\n              className=\"w-full bg-gradient-to-r from-violet-500 to-purple-600 text-white font-bold py-3 rounded-xl hover:shadow-lg transform hover:scale-105 transition\"\n            >\n               New Challenge\n            </button>\n            <button\n              onClick={onBack}\n              className=\"w-full py-3 text-gray-500 font-semibold hover:text-gray-700 transition\"\n            >\n               Back to Modules\n            </button>\n          </div>\n        </div>\n      </div>\n    );\n  }\n\n  // Fallback\n  return null;\n}\n","import React, { useState } from 'react';\nimport QuestionCard from './QuestionCard';\nimport ChallengeMode from './ChallengeMode';\nimport { getModulesByGrade } from '../data/mathModules';\n\nconst ALL_GRADES = ['KG-1', '2-3', '4-5', '6-7', '7-8', '9+'];\n\nconst GRADE_INFO = {\n  'KG-1': { name: 'Kindergarten - 1st Grade', color: 'from-pink-400 to-red-400', icon: '' },\n  '2-3': { name: '2nd - 3rd Grade', color: 'from-orange-400 to-yellow-400', icon: '' },\n  '4-5': { name: '4th - 5th Grade', color: 'from-green-400 to-teal-400', icon: '' },\n  '6-7': { name: '6th - 7th Grade', color: 'from-blue-400 to-cyan-400', icon: '' },\n  '7-8': { name: '7th - 8th Grade', color: 'from-purple-400 to-indigo-400', icon: '' },\n  '9+': { name: '9th Grade and Above', color: 'from-indigo-500 to-purple-600', icon: '' },\n};\n\n// Convert numeric grade (1-12) to grade range string (KG-1, 2-3, etc.)\nconst convertGradeFormat = (grade) => {\n  if (typeof grade === 'string') {\n    // Already in correct format\n    if (GRADE_INFO[grade]) return grade;\n  }\n  \n  const gradeNum = parseInt(grade);\n  \n  if (gradeNum <= 1) return 'KG-1';\n  if (gradeNum <= 3) return '2-3';\n  if (gradeNum <= 5) return '4-5';\n  if (gradeNum <= 7) return '6-7';\n  if (gradeNum <= 8) return '7-8';\n  return '9+';\n};\n\nexport default function ModuleSelector({ userId, userGrade, userProfile, onXPUpdate }) {\n  const [mode, setMode] = useState(null);\n  const [selectedGrade, setSelectedGrade] = useState(convertGradeFormat(userGrade) || '4-5');\n  const [selectedModules, setSelectedModules] = useState([]);\n\n  if (mode === 'challenge') {\n    return (\n      <ChallengeMode\n        userId={userId}\n        userName={userProfile?.name || 'Player'}\n        userGrade={selectedGrade}\n        selectedModules={selectedModules}\n        onBack={() => setMode(null)}\n      />\n    );\n  }\n\n  if (mode) {\n    return (\n      <QuestionCard\n        userId={userId}\n        userGrade={selectedGrade}\n        mode={mode}\n        selectedModules={selectedModules}\n        onEndSession={() => {\n          setMode(null);\n        }}\n        onXPUpdate={onXPUpdate}\n      />\n    );\n  }\n\n  const currentGradeModules = getModulesByGrade(selectedGrade)?.modules || [];\n  const allModuleNames = currentGradeModules.map(m => m.name);\n\n  const toggleModule = (moduleName) => {\n    setSelectedModules(prev =>\n      prev.includes(moduleName)\n        ? prev.filter(m => m !== moduleName)\n        : [...prev, moduleName]\n    );\n  };\n\n  const selectAllModules = () => {\n    setSelectedModules(allModuleNames);\n  };\n\n  const clearAllModules = () => {\n    setSelectedModules([]);\n  };\n\n  return (\n    <div className=\"min-h-[calc(100vh-52px)] bg-violet-50 p-2 sm:p-4 flex flex-col\">\n      <div className=\"max-w-7xl mx-auto w-full flex flex-col h-full\">\n        {/* Header */}\n        <div className=\"text-center mb-2 flex-shrink-0\">\n          <h1 className=\"text-2xl sm:text-3xl lg:text-4xl font-bold text-gray-800 mb-0.5\">\n             Choose Your Modules\n          </h1>\n          <p className=\"text-xs sm:text-sm lg:text-base text-gray-600\">\n            Hi {userProfile?.name}! Select a grade & modules \n          </p>\n        </div>\n\n        {/* Grade + Modules on one page */}\n        <div className=\"flex flex-col flex-1 gap-2\">\n          {/* Grades Section */}\n          <div className=\"bg-white rounded-xl p-2 shadow-lg flex-shrink-0\">\n            <h3 className=\"text-sm sm:text-base lg:text-lg font-bold text-gray-800 mb-2\">\n               Select Your Grade\n            </h3>\n            <div className=\"grid grid-cols-3 sm:grid-cols-3 lg:grid-cols-6 gap-1.5 sm:gap-2\">\n              {ALL_GRADES.map(grade => {\n                const info = GRADE_INFO[grade];\n                const isSelected = grade === selectedGrade;\n                const gradeModules = getModulesByGrade(grade)?.modules || [];\n                const moduleCount = gradeModules.length;\n                \n                return (\n                  <button\n                    key={grade}\n                    onClick={() => { setSelectedGrade(grade); setSelectedModules([]); }}\n                    aria-label={`Select ${info.name}`}\n                    aria-pressed={isSelected}\n                    className={`p-2 rounded-lg border-2 text-left transition-all duration-200 flex flex-col ${\n                      isSelected\n                        ? `bg-gradient-to-r ${info.color} text-white border-2 border-white shadow-lg`\n                        : 'bg-gray-50 border-gray-300 hover:border-gray-400 hover:shadow-md hover:-translate-y-0.5'\n                    }`}\n                  >\n                    <div className=\"text-2xl sm:text-3xl lg:text-4xl mb-1\">{info.icon}</div>\n                    <div>\n                      <div className={`font-bold text-xs sm:text-sm lg:text-base ${isSelected ? 'text-white' : 'text-gray-800'} leading-tight`}>\n                        {grade}\n                      </div>\n                      <div className={`text-xs leading-tight ${isSelected ? 'text-white opacity-90' : 'text-gray-600'}`}>\n                        {info.name}\n                      </div>\n                      <div className={`text-xs leading-tight mt-1 ${isSelected ? 'text-white opacity-80' : 'text-gray-500'}`}>\n                        {moduleCount} \n                      </div>\n                    </div>\n                  </button>\n                );\n              })}\n            </div>\n          </div>\n\n          {/* Modules Section */}\n          <div className=\"bg-white rounded-xl p-2 shadow-lg flex flex-col flex-1 overflow-hidden\">\n            <div className=\"flex justify-between items-center mb-2 flex-shrink-0\">\n              <h3 className=\"text-sm sm:text-base lg:text-lg font-bold text-gray-800\">\n                 Modules for {selectedGrade}\n              </h3>\n              <div className=\"flex gap-1\">\n                <button\n                  onClick={selectAllModules}\n                  className=\"px-3 py-2 min-h-[44px] text-xs sm:text-sm bg-emerald-500 text-white font-semibold rounded-lg hover:bg-emerald-600 transition\"\n                >\n                   All\n                </button>\n                <button\n                  onClick={clearAllModules}\n                  className=\"px-3 py-2 min-h-[44px] text-xs sm:text-sm bg-red-500 text-white font-semibold rounded-lg hover:bg-red-600 transition\"\n                >\n                   Clear\n                </button>\n              </div>\n            </div>\n\n            {/* Module Cards Grid */}\n            <div className=\"grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-4 gap-1.5 sm:gap-2 overflow-y-auto flex-1 mb-2 content-start max-h-[40vh] sm:max-h-[50vh]\">\n              {currentGradeModules.map((module, index) => {\n                const isSelected = selectedModules.includes(module.name);\n                const moduleColors = [\n                  'from-pink-400 to-rose-400',\n                  'from-orange-400 to-amber-400',\n                  'from-green-400 to-emerald-400',\n                  'from-blue-400 to-cyan-400',\n                  'from-purple-400 to-violet-400',\n                  'from-teal-400 to-green-400',\n                  'from-indigo-400 to-blue-400',\n                  'from-yellow-400 to-orange-400',\n                  'from-rose-400 to-pink-400',\n                  'from-cyan-400 to-teal-400',\n                ];\n                const moduleIcons = {\n                  'Addition': '',\n                  'Subtraction': '',\n                  'Multiplication': '',\n                  'Division': '',\n                  'Fractions': '',\n                  'Logic & Patterns': '',\n                  'Arithmetic Operations': '',\n                  'Arithmetic': '',\n                  'Arithmetic & Number Theory': '',\n                  'Fractions & Decimals': '',\n                  'Fractions, Decimals & Percentages': '',\n                  'Geometry': '',\n                  'Geometry & Trigonometry': '',\n                  'Variables & Equations': '',\n                  'Algebra': '',\n                  'Pre-Algebra': '',\n                  'Statistics & Probability': '',\n                  'Advanced Reasoning': '',\n                  'Mathematical Reasoning': '',\n                  'Functions & Graphing': '',\n                  'Functions & Analysis': '',\n                  'Exponents & Roots': '',\n                  'Calculus Basics': '',\n                };\n                const icon = moduleIcons[module.name] || '';\n                const color = moduleColors[index % moduleColors.length];\n\n                return (\n                  <button\n                    key={module.name}\n                    onClick={() => toggleModule(module.name)}\n                    aria-label={`${isSelected ? 'Deselect' : 'Select'} ${module.name} module`}\n                    aria-pressed={isSelected}\n                    className={`p-2 rounded-lg border-2 text-left transition-all duration-200 flex flex-col ${\n                      isSelected\n                        ? `bg-gradient-to-r ${color} text-white border-white shadow-lg`\n                        : 'bg-gray-50 border-gray-300 hover:border-gray-400 hover:shadow-md hover:-translate-y-0.5'\n                    }`}\n                  >\n                    <div className=\"text-xl sm:text-2xl mb-1\">{isSelected ? '' : icon}</div>\n                    <div className={`font-bold text-xs sm:text-sm leading-tight ${isSelected ? 'text-white' : 'text-gray-800'}`}>\n                      {module.name}\n                    </div>\n                    <div className={`text-xs leading-tight mt-0.5 ${isSelected ? 'text-white opacity-80' : 'text-gray-500'}`}>\n                      {module.topics.length} topics\n                    </div>\n                  </button>\n                );\n              })}\n            </div>\n\n            {selectedModules.length === 0 && (\n              <div className=\"bg-blue-50 border border-blue-200 rounded-lg p-3 mb-2 flex-shrink-0 text-center\">\n                <p className=\"text-sm text-blue-700 font-semibold\"> Tap modules above to get started!</p>\n              </div>\n            )}\n\n            {/* Start Buttons */}\n            <div className=\"grid grid-cols-3 gap-2 flex-shrink-0\">\n              <button\n                onClick={() => selectedModules.length > 0 && setMode('play')}\n                disabled={selectedModules.length === 0}\n                className=\"bg-gradient-to-r from-amber-400 to-orange-500 text-white font-bold py-3 min-h-[44px] rounded-lg hover:shadow-lg transform hover:scale-105 transition disabled:opacity-50 text-xs sm:text-sm\"\n              >\n                 Play\n              </button>\n              <button\n                onClick={() => selectedModules.length > 0 && setMode('test')}\n                disabled={selectedModules.length === 0}\n                className=\"bg-gradient-to-r from-violet-500 to-purple-600 text-white font-bold py-3 min-h-[44px] rounded-lg hover:shadow-lg transform hover:scale-105 transition disabled:opacity-50 text-xs sm:text-sm\"\n              >\n                 Test\n              </button>\n              <button\n                onClick={() => setMode('challenge')}\n                className=\"bg-gradient-to-r from-rose-500 to-pink-600 text-white font-bold py-3 min-h-[44px] rounded-lg hover:shadow-lg transform hover:scale-105 transition text-xs sm:text-sm\"\n              >\n                 Challenge\n              </button>\n            </div>\n          </div>\n        </div>\n      </div>\n    </div>\n  );\n}\n"],"names":["mathModulesByGrade","gradeLevel","complexity","modules","name","topics","getModulesByGrade","grade","getRandomTopicByGrade","forEach","module","push","getTopicsByGrade","Math","floor","random","length","generateQuestion","async","userHistory","userGrade","operation","selectedModules","arguments","undefined","isAiPreferred","includes","process","REACT_APP_OPENAI_API_KEY","generateAIQuestion","aiProbability","question","generateFallbackQuestion","answer","relevantTopic","getTopicFromSelectedModules","gradeData","topicsFromSelectedModules","complexityLevel","recentAccuracy","slice","reduce","sum","h","correct","min","moduleContext","concat","join","questionTypeGuidance","some","m","prompt","raw","axios","post","model","messages","role","content","max_tokens","temperature","headers","data","choices","message","trim","cleaned","replace","parsed","JSON","parse","parseErr","console","warn","error","gradeComplexity","maxNum","maxOp","questionsMap","addition","subtraction","multiplication","division","fractions","decimals","algebra","geometry","statistics","calculus","logic_patterns","questions","QuestionCard","_ref","userId","mode","onNext","onEndSession","onXPUpdate","setQuestion","useState","setOperation","userAnswer","setUserAnswer","correctAnswer","setCorrectAnswer","feedback","setFeedback","isCorrect","setIsCorrect","loading","setLoading","showHint","setShowHint","sessionStats","setSessionStats","total","difficulty","questionsInSession","setQuestionsInSession","elapsedTime","setElapsedTime","missedQuestions","setMissedQuestions","showSummary","setShowSummary","showCelebration","setShowCelebration","showPlaySummary","setShowPlaySummary","loadError","setLoadError","timerRef","useRef","currentStreak","setCurrentStreak","xpEarnedPopup","setXpEarnedPopup","sessionXP","setSessionXP","showLevelUp","setShowLevelUp","newLevelInfo","setNewLevelInfo","isSubmitting","setIsSubmitting","autoAdvanceRef","historyRef","useEffect","loadQuestion","current","clearTimeout","setInterval","prev","clearInterval","history","getUserAnswerHistory","availableOps","getOperationsFromModules","moduleToOps","ops","Set","op","add","Array","from","getAdaptiveOperation","getRandomOperation","result","q","calculateAnswer","operations","accuracy","log","weakOps","Object","entries","filter","_ref2","sort","_ref3","_ref4","a","b","map","_ref5","algebraPattern","algebraMatch","match","A","parseInt","op2","B","C","simpleAlgebra","simpleMatch","numbers","dimensions","round","superscriptMap","sqrtMatch","val","root","sqrt","Number","isInteger","cbrtMatch","cbrt","caretMatch","pow","superMatch","base","expStr","exp","ch","powerMatch","sqrtWordMatch","cbrtWordMatch","expMulMatch","base1","exp1Str","base2","exp2Str","exp1","exp2","letters","firstLetter","toUpperCase","diff","charCodeAt","nextCharCode","String","fromCharCode","seqMatch","nums","n","isFibLike","i","ratio","isGeometric","diffs","diffs2","every","d","nextDiff","lastNum","chainedAddition","chainedSubtraction","chainedMultiplication","allNumbers","parseFloat","product","fractionPattern","num1","den1","operator","num2","den2","simpleFraction","match2","reversePattern","match3","num","den","reversePattern2","match4","pattern","handleNextQuestion","calculateDifficulty","thresholds","veryEasy","easy","medium","hard","veryHard","getDifficultyThresholdsForGrade","threshold","calculateGradeAwareDifficulty","getExplanation","formatTime","seconds","mins","secs","toString","padStart","pct","emoji","_jsx","className","children","_jsxs","mq","yourAnswer","onClick","gradeColor","hasProgress","window","confirm","title","_Fragment","onSubmit","e","preventDefault","userVal","parsedUserVal","input","trimmed","NaN","mixedMatch","whole","fractionMatch","parseFractionInput","isNaN","abs","newStreak","successMessages","streakMessages","msg","setTimeout","explanation","newTotal","newCorrect","newDifficulty","xpResult","awardXP","streak","xpEarned","xp","leveledUp","newLevel","level","getLevelTitle","saveAnswer","type","inputMode","value","onChange","target","placeholder","disabled","autoFocus","getHintForOperation","hints","opHints","_","drift","style","left","animationDelay","animationDuration","split","CHALLENGES_COL","createChallenge","userName","questionGenerator","code","chars","generateCode","id","Date","now","challengeDoc","creatorId","creatorName","opponentId","opponentName","status","creatorAnswers","opponentAnswers","createdAt","serverTimestamp","startedAt","completedAt","setDoc","doc","db","_objectSpread","parseAnswer","str","s","test","MODULE_TO_OPS","Addition","Subtraction","Multiplication","Division","Fractions","Geometry","Algebra","Arithmetic","generateChallengeQuestions","count","o","opsArr","_unused","ChallengeMode","onBack","screen","setScreen","challengeData","setChallengeData","joinCode","setJoinCode","setError","setRole","currentQ","setCurrentQ","myAnswers","setMyAnswers","opponentProgress","setOpponentProgress","questionStartTime","setQuestionStartTime","unsubRef","inputRef","startListening","useCallback","challengeId","myRole","onChallengeUpdate","callback","ref","onSnapshot","snap","exists","focus","handleCreate","challenge","handleJoin","query","collection","where","getDocs","empty","Error","docs","updateDoc","joinChallenge","handleSubmit","u","toLowerCase","c","uNum","cNum","answersMatch","timeMs","answerData","getDoc","field","updatedAnswers","updates","otherAnswers","submitChallengeAnswer","err","maxLength","fill","stroke","viewBox","strokeLinecap","strokeLinejoin","strokeWidth","isLastQ","myProgress","totalQ","width","r","getResults","ca","oa","creatorScore","opponentScore","creatorTime","opponentTime","totalQuestions","iAmCreator","myScore","theirScore","myTime","theirTime","myName","theirName","myAns","theirAns","iWon","tie","toFixed","_myAns$i","_myAns$i2","_theirAns$i","_theirAns$i2","ALL_GRADES","GRADE_INFO","color","icon","ModuleSelector","_getModulesByGrade","userProfile","setMode","selectedGrade","setSelectedGrade","gradeNum","convertGradeFormat","setSelectedModules","currentGradeModules","allModuleNames","_getModulesByGrade2","info","isSelected","moduleCount","selectAllModules","clearAllModules","index","moduleColors","toggleModule","moduleName"],"ignoreList":[],"sourceRoot":""}